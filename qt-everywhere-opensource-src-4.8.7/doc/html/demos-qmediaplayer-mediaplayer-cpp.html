<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Qt 4.8: mediaplayer.cpp Example File (demos/qmediaplayer/mediaplayer.cpp)</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />
  <link rel="stylesheet" type="text/css" href="style/narrow.css" />
  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->

<script src="scripts/superfish.js" type="text/javascript"></script>
<script src="scripts/narrow.js" type="text/javascript"></script>

</head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="narrowsearch"></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.digia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://qt-project.org/">DEV</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://qt-project.org/doc/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.digia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.8</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt-project.org/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu" id="narrowmenu"> 
             <li><a href="#">API Lookup</a> 
                 <ul> 
                     <li><a href="classes.html">Class index</a></li> 
           <li><a href="functions.html">Function index</a></li> 
           <li><a href="modules.html">Modules</a></li> 
           <li><a href="namespaces.html">Namespaces</a></li> 
           <li><a href="qtglobal.html">Global Declarations</a></li> 
           <li><a href="qdeclarativeelements.html">QML elements</a></li> 
             </ul> 
             </li> 
             <li><a href="#">Qt Topics</a> 
                 <ul> 
                        <li><a href="qt-basic-concepts.html">Programming with Qt</a></li>  
                        <li><a href="qtquick.html">Device UIs &amp; Qt Quick</a></li>  
                        <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li>  
                        <li><a href="supported-platforms.html">Supported Platforms</a></li>  
                        <li><a href="technology-apis.html">Qt and Key Technologies</a></li>  
                        <li><a href="best-practices.html">How-To's and Best Practices</a></li>  
              </ul> 
                 </li> 
                 <li><a href="#">Examples</a> 
                     <ul> 
                       <li><a href="all-examples.html">Examples</a></li> 
                       <li><a href="tutorials.html">Tutorials</a></li> 
                       <li><a href="demos.html">Demos</a></li> 
                       <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
                </ul> 
                     </li> 
                 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search" id="sidebarsearch">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
 <div id="resultdialog"> 
 <a href="#" id="resultclose">Close</a> 
 <p id="resultlinks" class="all"><a href="#" id="showallresults">All</a> | <a href="#" id="showapiresults">API</a> | <a href="#" id="showarticleresults">Articles</a> | <a href="#" id="showexampleresults">Examples</a></p> 
 <p id="searchcount" class="all"><span id="resultcount"></span><span id="apicount"></span><span id="articlecount"></span><span id="examplecount"></span>&nbsp;results:</p> 
 <ul id="resultlist" class="all"> 
 </ul> 
 </div> 
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
               <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
               <li class="defaultLink"><a href="qtquick.html">Device UIs &amp; Qt Quick</a></li> 
               <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
               <li class="defaultLink"><a href="supported-platforms.html">Supported Platforms</a></li>  
               <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
               <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Breadcrumbs go here -->
            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content mainContent">
<h1 class="title">mediaplayer.cpp Example File</h1>
<span class="small-subtitle">demos/qmediaplayer/mediaplayer.cpp</span>
<!-- $$$demos/qmediaplayer/mediaplayer.cpp-description -->
<div class="descr"> <a name="details"></a>
<pre class="cpp"> <span class="comment">/****************************************************************************
 **
 ** Copyright (C) 2015 The Qt Company Ltd.
 ** Contact: http://www.qt.io/licensing/
 **
 ** This file is part of the demonstration applications of the Qt Toolkit.
 **
 ** $QT_BEGIN_LICENSE:LGPL$
 ** Commercial License Usage
 ** Licensees holding valid commercial Qt licenses may use this file in
 ** accordance with the commercial license agreement provided with the
 ** Software or, alternatively, in accordance with the terms contained in
 ** a written agreement between you and The Qt Company. For licensing terms
 ** and conditions see http://www.qt.io/terms-conditions. For further
 ** information use the contact form at http://www.qt.io/contact-us.
 **
 ** GNU Lesser General Public License Usage
 ** Alternatively, this file may be used under the terms of the GNU Lesser
 ** General Public License version 2.1 or version 3 as published by the Free
 ** Software Foundation and appearing in the file LICENSE.LGPLv21 and
 ** LICENSE.LGPLv3 included in the packaging of this file. Please review the
 ** following information to ensure the GNU Lesser General Public License
 ** requirements will be met: https://www.gnu.org/licenses/lgpl.html and
 ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
 **
 ** As a special exception, The Qt Company gives you certain additional
 ** rights. These rights are described in The Qt Company LGPL Exception
 ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
 **
 ** GNU General Public License Usage
 ** Alternatively, this file may be used under the terms of the GNU
 ** General Public License version 3.0 as published by the Free Software
 ** Foundation and appearing in the file LICENSE.GPL included in the
 ** packaging of this file.  Please review the following information to
 ** ensure the GNU General Public License version 3.0 requirements will be
 ** met: http://www.gnu.org/copyleft/gpl.html.
 **
 ** $QT_END_LICENSE$
 **
 ***************************************************************************/</span>

 <span class="preprocessor">#include &lt;QtGui&gt;</span>

 <span class="preprocessor">#define SLIDER_RANGE 8</span>

 <span class="preprocessor">#include &quot;mediaplayer.h&quot;</span>
 <span class="preprocessor">#include &quot;ui_settings.h&quot;</span>

 <span class="preprocessor">#ifdef Q_OS_SYMBIAN</span>
 <span class="preprocessor">#include &lt;cdbcols.h&gt;</span>
 <span class="preprocessor">#include &lt;cdblen.h&gt;</span>
 <span class="preprocessor">#include &lt;commdb.h&gt;</span>
 <span class="preprocessor">#endif</span>

 MediaVideoWidget<span class="operator">::</span>MediaVideoWidget(MediaPlayer <span class="operator">*</span>player<span class="operator">,</span> <span class="type"><a href="qwidget.html">QWidget</a></span> <span class="operator">*</span>parent) :
     Phonon<span class="operator">::</span>VideoWidget(parent)<span class="operator">,</span> m_player(player)<span class="operator">,</span> m_action(<span class="keyword">this</span>)
 {
     m_action<span class="operator">.</span>setCheckable(<span class="keyword">true</span>);
     m_action<span class="operator">.</span>setChecked(<span class="keyword">false</span>);
     m_action<span class="operator">.</span>setShortcut(<span class="type"><a href="qkeysequence.html">QKeySequence</a></span>( <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>AltModifier <span class="operator">+</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>Key_Return));
     m_action<span class="operator">.</span>setShortcutContext(<span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>WindowShortcut);
     connect(<span class="operator">&amp;</span>m_action<span class="operator">,</span> SIGNAL(toggled(<span class="type">bool</span>))<span class="operator">,</span> SLOT(setFullScreen(<span class="type">bool</span>)));
     addAction(<span class="operator">&amp;</span>m_action);
     setAcceptDrops(<span class="keyword">true</span>);
 }

 <span class="type">void</span> MediaVideoWidget<span class="operator">::</span>setFullScreen(<span class="type">bool</span> enabled)
 {
     Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>setFullScreen(enabled);
     <span class="keyword">emit</span> fullScreenChanged(enabled);
 }

 <span class="type">void</span> MediaVideoWidget<span class="operator">::</span>mouseDoubleClickEvent(<span class="type"><a href="qmouseevent.html">QMouseEvent</a></span> <span class="operator">*</span>e)
 {
     Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>mouseDoubleClickEvent(e);
     setFullScreen(<span class="operator">!</span>isFullScreen());
 }

 <span class="type">void</span> MediaVideoWidget<span class="operator">::</span>keyPressEvent(<span class="type"><a href="qkeyevent.html">QKeyEvent</a></span> <span class="operator">*</span>e)
 {
     <span class="keyword">if</span>(<span class="operator">!</span>e<span class="operator">-</span><span class="operator">&gt;</span>modifiers()) {
         <span class="comment">// On non-QWERTY Symbian key-based devices, there is no space key.</span>
         <span class="comment">// The zero key typically is marked with a space character.</span>
         <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>key() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>Key_Space <span class="operator">|</span><span class="operator">|</span> e<span class="operator">-</span><span class="operator">&gt;</span>key() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>Key_0) {
             m_player<span class="operator">-</span><span class="operator">&gt;</span>playPause();
             e<span class="operator">-</span><span class="operator">&gt;</span>accept();
             <span class="keyword">return</span>;
         }

         <span class="comment">// On Symbian devices, there is no key which maps to Qt::Key_Escape</span>
         <span class="comment">// On devices which lack a backspace key (i.e. non-QWERTY devices),</span>
         <span class="comment">// the 'C' key maps to Qt::Key_Backspace</span>
         <span class="keyword">else</span> <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>key() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>Key_Escape <span class="operator">|</span><span class="operator">|</span> e<span class="operator">-</span><span class="operator">&gt;</span>key() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>Key_Backspace) {
             setFullScreen(<span class="keyword">false</span>);
             e<span class="operator">-</span><span class="operator">&gt;</span>accept();
             <span class="keyword">return</span>;
         }
     }
     Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>keyPressEvent(e);
 }

 <span class="type">bool</span> MediaVideoWidget<span class="operator">::</span>event(<span class="type"><a href="qevent.html">QEvent</a></span> <span class="operator">*</span>e)
 {
     <span class="keyword">switch</span>(e<span class="operator">-</span><span class="operator">&gt;</span>type())
     {
     <span class="keyword">case</span> <span class="type"><a href="qevent.html">QEvent</a></span><span class="operator">::</span>Close:
         <span class="comment">//we just ignore the cose events on the video widget</span>
         <span class="comment">//this prevents ALT+F4 from having an effect in fullscreen mode</span>
         e<span class="operator">-</span><span class="operator">&gt;</span>ignore();
         <span class="keyword">return</span> <span class="keyword">true</span>;
     <span class="keyword">case</span> <span class="type"><a href="qevent.html">QEvent</a></span><span class="operator">::</span>MouseMove:
 <span class="preprocessor">#ifndef QT_NO_CURSOR</span>
         unsetCursor();
 <span class="preprocessor">#endif</span>
         <span class="comment">//fall through</span>
     <span class="keyword">case</span> <span class="type"><a href="qevent.html">QEvent</a></span><span class="operator">::</span>WindowStateChange:
         {
             <span class="comment">//we just update the state of the checkbox, in case it wasn't already</span>
             m_action<span class="operator">.</span>setChecked(windowState() <span class="operator">&amp;</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>WindowFullScreen);
             <span class="keyword">const</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>WindowFlags flags <span class="operator">=</span> m_player<span class="operator">-</span><span class="operator">&gt;</span>windowFlags();
             <span class="keyword">if</span> (windowState() <span class="operator">&amp;</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>WindowFullScreen) {
                 m_timer<span class="operator">.</span>start(<span class="number">1000</span><span class="operator">,</span> <span class="keyword">this</span>);
             } <span class="keyword">else</span> {
                 m_timer<span class="operator">.</span>stop();
 <span class="preprocessor">#ifndef QT_NO_CURSOR</span>
                 unsetCursor();
 <span class="preprocessor">#endif</span>
             }
         }
         <span class="keyword">break</span>;
     <span class="keyword">default</span>:
         <span class="keyword">break</span>;
     }

     <span class="keyword">return</span> Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>event(e);
 }

 <span class="type">void</span> MediaVideoWidget<span class="operator">::</span>timerEvent(<span class="type"><a href="qtimerevent.html">QTimerEvent</a></span> <span class="operator">*</span>e)
 {
     <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>timerId() <span class="operator">=</span><span class="operator">=</span> m_timer<span class="operator">.</span>timerId()) {
         <span class="comment">//let's store the cursor shape</span>
 <span class="preprocessor">#ifndef QT_NO_CURSOR</span>
         setCursor(<span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>BlankCursor);
 <span class="preprocessor">#endif</span>
     }
     Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>timerEvent(e);
 }

 <span class="type">void</span> MediaVideoWidget<span class="operator">::</span>dropEvent(<span class="type"><a href="qdropevent.html">QDropEvent</a></span> <span class="operator">*</span>e)
 {
     m_player<span class="operator">-</span><span class="operator">&gt;</span>handleDrop(e);
 }

 <span class="type">void</span> MediaVideoWidget<span class="operator">::</span>dragEnterEvent(<span class="type"><a href="qdragenterevent.html">QDragEnterEvent</a></span> <span class="operator">*</span>e) {
     <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>mimeData()<span class="operator">-</span><span class="operator">&gt;</span>hasUrls())
         e<span class="operator">-</span><span class="operator">&gt;</span>acceptProposedAction();
 }

 MediaPlayer<span class="operator">::</span>MediaPlayer() :
         playButton(<span class="number">0</span>)<span class="operator">,</span> nextEffect(<span class="number">0</span>)<span class="operator">,</span> settingsDialog(<span class="number">0</span>)<span class="operator">,</span> ui(<span class="number">0</span>)<span class="operator">,</span>
             m_AudioOutput(Phonon<span class="operator">::</span>VideoCategory)<span class="operator">,</span>
             m_videoWidget(<span class="keyword">new</span> MediaVideoWidget(<span class="keyword">this</span>))
 {
     setWindowTitle(tr(<span class="string">&quot;Media Player&quot;</span>));
     setContextMenuPolicy(<span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>CustomContextMenu);
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setContextMenuPolicy(<span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>CustomContextMenu);

     <span class="type"><a href="qsize.html">QSize</a></span> buttonSize(<span class="number">34</span><span class="operator">,</span> <span class="number">28</span>);

     <span class="type"><a href="qpushbutton.html">QPushButton</a></span> <span class="operator">*</span>openButton <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qpushbutton.html">QPushButton</a></span>(<span class="keyword">this</span>);

     openButton<span class="operator">-</span><span class="operator">&gt;</span>setIcon(style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="qstyle.html">QStyle</a></span><span class="operator">::</span>SP_DialogOpenButton));
     <span class="type"><a href="qpalette.html">QPalette</a></span> bpal;
     <span class="type"><a href="qcolor.html">QColor</a></span> arrowcolor <span class="operator">=</span> bpal<span class="operator">.</span>buttonText()<span class="operator">.</span>color();
     <span class="keyword">if</span> (arrowcolor <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>black)
         arrowcolor <span class="operator">=</span> <span class="type"><a href="qcolor.html">QColor</a></span>(<span class="number">80</span><span class="operator">,</span> <span class="number">80</span><span class="operator">,</span> <span class="number">80</span>);
     bpal<span class="operator">.</span>setBrush(<span class="type"><a href="qpalette.html">QPalette</a></span><span class="operator">::</span>ButtonText<span class="operator">,</span> arrowcolor);
     openButton<span class="operator">-</span><span class="operator">&gt;</span>setPalette(bpal);

     rewindButton <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qpushbutton.html">QPushButton</a></span>(<span class="keyword">this</span>);
     rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setIcon(style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="qstyle.html">QStyle</a></span><span class="operator">::</span>SP_MediaSkipBackward));

     forwardButton <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qpushbutton.html">QPushButton</a></span>(<span class="keyword">this</span>);
     forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setIcon(style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="qstyle.html">QStyle</a></span><span class="operator">::</span>SP_MediaSkipForward));
     forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);

     playButton <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qpushbutton.html">QPushButton</a></span>(<span class="keyword">this</span>);
     playIcon <span class="operator">=</span> style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="qstyle.html">QStyle</a></span><span class="operator">::</span>SP_MediaPlay);
     pauseIcon <span class="operator">=</span> style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="qstyle.html">QStyle</a></span><span class="operator">::</span>SP_MediaPause);
     playButton<span class="operator">-</span><span class="operator">&gt;</span>setIcon(playIcon);

     slider <span class="operator">=</span> <span class="keyword">new</span> Phonon<span class="operator">::</span>SeekSlider(<span class="keyword">this</span>);
     slider<span class="operator">-</span><span class="operator">&gt;</span>setMediaObject(<span class="operator">&amp;</span>m_MediaObject);
     volume <span class="operator">=</span> <span class="keyword">new</span> Phonon<span class="operator">::</span>VolumeSlider(<span class="operator">&amp;</span>m_AudioOutput);

     <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span> <span class="operator">*</span>vLayout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span>(<span class="keyword">this</span>);
     vLayout<span class="operator">-</span><span class="operator">&gt;</span>setContentsMargins(<span class="number">8</span><span class="operator">,</span> <span class="number">8</span><span class="operator">,</span> <span class="number">8</span><span class="operator">,</span> <span class="number">8</span>);

     <span class="type"><a href="qhboxlayout.html">QHBoxLayout</a></span> <span class="operator">*</span>layout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qhboxlayout.html">QHBoxLayout</a></span>();

     info <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qlabel.html">QLabel</a></span>(<span class="keyword">this</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setMinimumHeight(<span class="number">70</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setAcceptDrops(<span class="keyword">false</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setMargin(<span class="number">2</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setFrameStyle(<span class="type"><a href="qframe.html">QFrame</a></span><span class="operator">::</span>StyledPanel <span class="operator">|</span> <span class="type"><a href="qframe.html">QFrame</a></span><span class="operator">::</span>Sunken);
     info<span class="operator">-</span><span class="operator">&gt;</span>setLineWidth(<span class="number">2</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setAutoFillBackground(<span class="keyword">true</span>);

     <span class="type"><a href="qpalette.html">QPalette</a></span> palette;
     palette<span class="operator">.</span>setBrush(<span class="type"><a href="qpalette.html">QPalette</a></span><span class="operator">::</span>WindowText<span class="operator">,</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>white);
 <span class="preprocessor">#ifndef Q_WS_MAC</span>
     openButton<span class="operator">-</span><span class="operator">&gt;</span>setMinimumSize(<span class="number">54</span><span class="operator">,</span> buttonSize<span class="operator">.</span>height());
     rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setMinimumSize(buttonSize);
     forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setMinimumSize(buttonSize);
     playButton<span class="operator">-</span><span class="operator">&gt;</span>setMinimumSize(buttonSize);
 <span class="preprocessor">#endif</span>
     info<span class="operator">-</span><span class="operator">&gt;</span>setStyleSheet(<span class="string">&quot;border-image:url(:/images/screen.png) ; border-width:3px&quot;</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setPalette(palette);
     info<span class="operator">-</span><span class="operator">&gt;</span>setText(tr(<span class="string">&quot;&lt;center&gt;No media&lt;/center&gt;&quot;</span>));

     volume<span class="operator">-</span><span class="operator">&gt;</span>setFixedWidth(<span class="number">120</span>);

     layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(openButton);
     layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(rewindButton);
     layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(playButton);
     layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(forwardButton);

     layout<span class="operator">-</span><span class="operator">&gt;</span>addStretch();
     layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(volume);

     vLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(info);
     initVideoWindow();
     vLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(<span class="operator">&amp;</span>m_videoWindow);
     <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span> <span class="operator">*</span>buttonPanelLayout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span>();
     m_videoWindow<span class="operator">.</span>hide();
     buttonPanelLayout<span class="operator">-</span><span class="operator">&gt;</span>addLayout(layout);

     timeLabel <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qlabel.html">QLabel</a></span>(<span class="keyword">this</span>);
     progressLabel <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qlabel.html">QLabel</a></span>(<span class="keyword">this</span>);
     <span class="type"><a href="qwidget.html">QWidget</a></span> <span class="operator">*</span>sliderPanel <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qwidget.html">QWidget</a></span>(<span class="keyword">this</span>);
     <span class="type"><a href="qhboxlayout.html">QHBoxLayout</a></span> <span class="operator">*</span>sliderLayout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qhboxlayout.html">QHBoxLayout</a></span>();
     sliderLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(slider);
     sliderLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(timeLabel);
     sliderLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(progressLabel);
     sliderLayout<span class="operator">-</span><span class="operator">&gt;</span>setContentsMargins(<span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span>);
     sliderPanel<span class="operator">-</span><span class="operator">&gt;</span>setLayout(sliderLayout);

     buttonPanelLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(sliderPanel);
     buttonPanelLayout<span class="operator">-</span><span class="operator">&gt;</span>setContentsMargins(<span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span>);
 <span class="preprocessor">#ifdef Q_OS_MAC</span>
     layout<span class="operator">-</span><span class="operator">&gt;</span>setSpacing(<span class="number">4</span>);
     buttonPanelLayout<span class="operator">-</span><span class="operator">&gt;</span>setSpacing(<span class="number">0</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setMinimumHeight(<span class="number">100</span>);
     info<span class="operator">-</span><span class="operator">&gt;</span>setFont(<span class="type"><a href="qfont.html">QFont</a></span>(<span class="string">&quot;verdana&quot;</span><span class="operator">,</span> <span class="number">15</span>));
     <span class="comment">// QStyle *flatButtonStyle = new QWindowsStyle;</span>
     openButton<span class="operator">-</span><span class="operator">&gt;</span>setFocusPolicy(<span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>NoFocus);
     <span class="comment">// openButton-&gt;setStyle(flatButtonStyle);</span>
     <span class="comment">// playButton-&gt;setStyle(flatButtonStyle);</span>
     <span class="comment">// rewindButton-&gt;setStyle(flatButtonStyle);</span>
     <span class="comment">// forwardButton-&gt;setStyle(flatButtonStyle);</span>
  <span class="preprocessor">#endif</span>
     <span class="type"><a href="qwidget.html">QWidget</a></span> <span class="operator">*</span>buttonPanelWidget <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qwidget.html">QWidget</a></span>(<span class="keyword">this</span>);
     buttonPanelWidget<span class="operator">-</span><span class="operator">&gt;</span>setSizePolicy(<span class="type"><a href="qsizepolicy.html">QSizePolicy</a></span><span class="operator">::</span>Preferred<span class="operator">,</span> <span class="type"><a href="qsizepolicy.html">QSizePolicy</a></span><span class="operator">::</span>Fixed);
     buttonPanelWidget<span class="operator">-</span><span class="operator">&gt;</span>setLayout(buttonPanelLayout);
     vLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(buttonPanelWidget);

     <span class="type"><a href="qhboxlayout.html">QHBoxLayout</a></span> <span class="operator">*</span>labelLayout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qhboxlayout.html">QHBoxLayout</a></span>();

     vLayout<span class="operator">-</span><span class="operator">&gt;</span>addLayout(labelLayout);
     setLayout(vLayout);

     <span class="comment">// Create menu bar:</span>
     fileMenu <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qmenu.html">QMenu</a></span>(<span class="keyword">this</span>);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>openFileAction <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Open &amp;File...&quot;</span>));
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>openUrlAction <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Open &amp;Location...&quot;</span>));
 <span class="preprocessor">#ifdef Q_OS_SYMBIAN</span>
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>selectIAPAction <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Select &amp;IAP...&quot;</span>));
     connect(selectIAPAction<span class="operator">,</span> SIGNAL(triggered(<span class="type">bool</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(selectIAP()));
 <span class="preprocessor">#endif</span>
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span><span class="keyword">const</span> openLinkAction <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Open &amp;RAM File...&quot;</span>));

     connect(openLinkAction<span class="operator">,</span> SIGNAL(triggered(<span class="type">bool</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(openRamFile()));

     fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addSeparator();
     <span class="type"><a href="qmenu.html">QMenu</a></span> <span class="operator">*</span>aspectMenu <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addMenu(tr(<span class="string">&quot;&amp;Aspect ratio&quot;</span>));
     <span class="type"><a href="qactiongroup.html">QActionGroup</a></span> <span class="operator">*</span>aspectGroup <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qactiongroup.html">QActionGroup</a></span>(aspectMenu);
     connect(aspectGroup<span class="operator">,</span> SIGNAL(triggered(<span class="type"><a href="qaction.html">QAction</a></span><span class="operator">*</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(aspectChanged(<span class="type"><a href="qaction.html">QAction</a></span><span class="operator">*</span>)));
     aspectGroup<span class="operator">-</span><span class="operator">&gt;</span>setExclusive(<span class="keyword">true</span>);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>aspectActionAuto <span class="operator">=</span> aspectMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Auto&quot;</span>));
     aspectActionAuto<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     aspectActionAuto<span class="operator">-</span><span class="operator">&gt;</span>setChecked(<span class="keyword">true</span>);
     aspectGroup<span class="operator">-</span><span class="operator">&gt;</span>addAction(aspectActionAuto);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>aspectActionScale <span class="operator">=</span> aspectMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Scale&quot;</span>));
     aspectActionScale<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     aspectGroup<span class="operator">-</span><span class="operator">&gt;</span>addAction(aspectActionScale);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>aspectAction16_9 <span class="operator">=</span> aspectMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;16/9&quot;</span>));
     aspectAction16_9<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     aspectGroup<span class="operator">-</span><span class="operator">&gt;</span>addAction(aspectAction16_9);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>aspectAction4_3 <span class="operator">=</span> aspectMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;4/3&quot;</span>));
     aspectAction4_3<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     aspectGroup<span class="operator">-</span><span class="operator">&gt;</span>addAction(aspectAction4_3);

     <span class="type"><a href="qmenu.html">QMenu</a></span> <span class="operator">*</span>scaleMenu <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addMenu(tr(<span class="string">&quot;&amp;Scale mode&quot;</span>));
     <span class="type"><a href="qactiongroup.html">QActionGroup</a></span> <span class="operator">*</span>scaleGroup <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qactiongroup.html">QActionGroup</a></span>(scaleMenu);
     connect(scaleGroup<span class="operator">,</span> SIGNAL(triggered(<span class="type"><a href="qaction.html">QAction</a></span><span class="operator">*</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(scaleChanged(<span class="type"><a href="qaction.html">QAction</a></span><span class="operator">*</span>)));
     scaleGroup<span class="operator">-</span><span class="operator">&gt;</span>setExclusive(<span class="keyword">true</span>);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>scaleActionFit <span class="operator">=</span> scaleMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Fit in view&quot;</span>));
     scaleActionFit<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     scaleActionFit<span class="operator">-</span><span class="operator">&gt;</span>setChecked(<span class="keyword">true</span>);
     scaleGroup<span class="operator">-</span><span class="operator">&gt;</span>addAction(scaleActionFit);
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>scaleActionCrop <span class="operator">=</span> scaleMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Scale and crop&quot;</span>));
     scaleActionCrop<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     scaleGroup<span class="operator">-</span><span class="operator">&gt;</span>addAction(scaleActionCrop);

     m_fullScreenAction <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;Full screen video&quot;</span>));
     m_fullScreenAction<span class="operator">-</span><span class="operator">&gt;</span>setCheckable(<span class="keyword">true</span>);
     m_fullScreenAction<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>); <span class="comment">// enabled by hasVideoChanged</span>
     <span class="type">bool</span> b <span class="operator">=</span> connect(m_fullScreenAction<span class="operator">,</span> SIGNAL(toggled(<span class="type">bool</span>))<span class="operator">,</span> m_videoWidget<span class="operator">,</span> SLOT(setFullScreen(<span class="type">bool</span>)));
     Q_ASSERT(b);
     b <span class="operator">=</span> connect(m_videoWidget<span class="operator">,</span> SIGNAL(fullScreenChanged(<span class="type">bool</span>))<span class="operator">,</span> m_fullScreenAction<span class="operator">,</span> SLOT(setChecked(<span class="type">bool</span>)));
     Q_ASSERT(b);

     fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addSeparator();
     <span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>settingsAction <span class="operator">=</span> fileMenu<span class="operator">-</span><span class="operator">&gt;</span>addAction(tr(<span class="string">&quot;&amp;Settings...&quot;</span>));

     <span class="comment">// Setup signal connections:</span>
     connect(rewindButton<span class="operator">,</span> SIGNAL(clicked())<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(rewind()));
     <span class="comment">//connect(openButton, SIGNAL(clicked()), this, SLOT(openFile()));</span>
     openButton<span class="operator">-</span><span class="operator">&gt;</span>setMenu(fileMenu);

     connect(playButton<span class="operator">,</span> SIGNAL(clicked())<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(playPause()));
     connect(forwardButton<span class="operator">,</span> SIGNAL(clicked())<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(forward()));
     <span class="comment">//connect(openButton, SIGNAL(clicked()), this, SLOT(openFile()));</span>
     connect(settingsAction<span class="operator">,</span> SIGNAL(triggered(<span class="type">bool</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(showSettingsDialog()));
     connect(openUrlAction<span class="operator">,</span> SIGNAL(triggered(<span class="type">bool</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(openUrl()));
     connect(openFileAction<span class="operator">,</span> SIGNAL(triggered(<span class="type">bool</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(openFile()));

     connect(m_videoWidget<span class="operator">,</span> SIGNAL(customContextMenuRequested(<span class="keyword">const</span> <span class="type"><a href="qpoint.html">QPoint</a></span> <span class="operator">&amp;</span>))<span class="operator">,</span> SLOT(showContextMenu(<span class="keyword">const</span> <span class="type"><a href="qpoint.html">QPoint</a></span> <span class="operator">&amp;</span>)));
     connect(<span class="keyword">this</span><span class="operator">,</span> SIGNAL(customContextMenuRequested(<span class="keyword">const</span> <span class="type"><a href="qpoint.html">QPoint</a></span> <span class="operator">&amp;</span>))<span class="operator">,</span> SLOT(showContextMenu(<span class="keyword">const</span> <span class="type"><a href="qpoint.html">QPoint</a></span> <span class="operator">&amp;</span>)));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(metaDataChanged())<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(updateInfo()));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(totalTimeChanged(<span class="type"><a href="qtglobal.html#qint64-typedef">qint64</a></span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(updateTime()));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(tick(<span class="type"><a href="qtglobal.html#qint64-typedef">qint64</a></span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(updateTime()));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(finished())<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(finished()));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(stateChanged(Phonon<span class="operator">::</span>State<span class="operator">,</span>Phonon<span class="operator">::</span>State))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(stateChanged(Phonon<span class="operator">::</span>State<span class="operator">,</span>Phonon<span class="operator">::</span>State)));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(bufferStatus(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(bufferStatus(<span class="type">int</span>)));
     connect(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> SIGNAL(hasVideoChanged(<span class="type">bool</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(hasVideoChanged(<span class="type">bool</span>)));

     rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
     playButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
     setAcceptDrops(<span class="keyword">true</span>);

     m_audioOutputPath <span class="operator">=</span> Phonon<span class="operator">::</span>createPath(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> <span class="operator">&amp;</span>m_AudioOutput);
     Phonon<span class="operator">::</span>createPath(<span class="operator">&amp;</span>m_MediaObject<span class="operator">,</span> m_videoWidget);

     resize(minimumSizeHint());
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>stateChanged(Phonon<span class="operator">::</span>State newstate<span class="operator">,</span> Phonon<span class="operator">::</span>State oldstate)
 {
     Q_UNUSED(oldstate);

     <span class="keyword">if</span> (oldstate <span class="operator">=</span><span class="operator">=</span> Phonon<span class="operator">::</span>LoadingState) {
         <span class="type"><a href="qrect.html">QRect</a></span> videoHintRect <span class="operator">=</span> <span class="type"><a href="qrect.html">QRect</a></span>(<span class="type"><a href="qpoint.html">QPoint</a></span>(<span class="number">0</span><span class="operator">,</span> <span class="number">0</span>)<span class="operator">,</span> m_videoWindow<span class="operator">.</span>sizeHint());
         <span class="type"><a href="qrect.html">QRect</a></span> newVideoRect <span class="operator">=</span> <span class="type"><a href="qapplication.html">QApplication</a></span><span class="operator">::</span>desktop()<span class="operator">-</span><span class="operator">&gt;</span>screenGeometry()<span class="operator">.</span>intersected(videoHintRect);
         <span class="keyword">if</span> (<span class="operator">!</span>m_smallScreen) {
             <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>hasVideo()) {
                 <span class="comment">// Flush event que so that sizeHint takes the</span>
                 <span class="comment">// recently shown/hidden m_videoWindow into account:</span>
                 qApp<span class="operator">-</span><span class="operator">&gt;</span>processEvents();
                 resize(sizeHint());
             } <span class="keyword">else</span>
                 resize(minimumSize());
         }
     }

     <span class="keyword">switch</span> (newstate) {
         <span class="keyword">case</span> Phonon<span class="operator">::</span>ErrorState:
             <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>errorType() <span class="operator">=</span><span class="operator">=</span> Phonon<span class="operator">::</span>FatalError) {
                 playButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
                 rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
             } <span class="keyword">else</span> {
                 m_MediaObject<span class="operator">.</span>pause();
             }
             <span class="type"><a href="qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>warning(<span class="keyword">this</span><span class="operator">,</span> <span class="string">&quot;Phonon Mediaplayer&quot;</span><span class="operator">,</span> m_MediaObject<span class="operator">.</span>errorString()<span class="operator">,</span> <span class="type"><a href="qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>Close);
             <span class="keyword">break</span>;

         <span class="keyword">case</span> Phonon<span class="operator">::</span>StoppedState:
             m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setFullScreen(<span class="keyword">false</span>);
             <span class="comment">// Fall through</span>
         <span class="keyword">case</span> Phonon<span class="operator">::</span>PausedState:
             playButton<span class="operator">-</span><span class="operator">&gt;</span>setIcon(playIcon);
             <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>currentSource()<span class="operator">.</span>type() <span class="operator">!</span><span class="operator">=</span> Phonon<span class="operator">::</span>MediaSource<span class="operator">::</span>Invalid){
                 playButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
                 rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
             } <span class="keyword">else</span> {
                 playButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
                 rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
             }
             <span class="keyword">break</span>;
         <span class="keyword">case</span> Phonon<span class="operator">::</span>PlayingState:
             playButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
             playButton<span class="operator">-</span><span class="operator">&gt;</span>setIcon(pauseIcon);
             <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>hasVideo())
                 m_videoWindow<span class="operator">.</span>show();
             <span class="comment">// Fall through</span>
         <span class="keyword">case</span> Phonon<span class="operator">::</span>BufferingState:
             rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
             <span class="keyword">break</span>;
         <span class="keyword">case</span> Phonon<span class="operator">::</span>LoadingState:
             rewindButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
             <span class="keyword">break</span>;
     }

 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>initSettingsDialog()
 {
     settingsDialog <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qdialog.html">QDialog</a></span>(<span class="keyword">this</span>);
     ui <span class="operator">=</span> <span class="keyword">new</span> Ui_settings();
     ui<span class="operator">-</span><span class="operator">&gt;</span>setupUi(settingsDialog);

     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>brightnessSlider<span class="operator">,</span> SIGNAL(valueChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(setBrightness(<span class="type">int</span>)));
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>hueSlider<span class="operator">,</span> SIGNAL(valueChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(setHue(<span class="type">int</span>)));
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>saturationSlider<span class="operator">,</span> SIGNAL(valueChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(setSaturation(<span class="type">int</span>)));
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>contrastSlider <span class="operator">,</span> SIGNAL(valueChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(setContrast(<span class="type">int</span>)));
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>aspectCombo<span class="operator">,</span> SIGNAL(currentIndexChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(setAspect(<span class="type">int</span>)));
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>scalemodeCombo<span class="operator">,</span> SIGNAL(currentIndexChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(setScale(<span class="type">int</span>)));

     ui<span class="operator">-</span><span class="operator">&gt;</span>brightnessSlider<span class="operator">-</span><span class="operator">&gt;</span>setValue(<span class="type">int</span>(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>brightness() <span class="operator">*</span> SLIDER_RANGE));
     ui<span class="operator">-</span><span class="operator">&gt;</span>hueSlider<span class="operator">-</span><span class="operator">&gt;</span>setValue(<span class="type">int</span>(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>hue() <span class="operator">*</span> SLIDER_RANGE));
     ui<span class="operator">-</span><span class="operator">&gt;</span>saturationSlider<span class="operator">-</span><span class="operator">&gt;</span>setValue(<span class="type">int</span>(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>saturation() <span class="operator">*</span> SLIDER_RANGE));
     ui<span class="operator">-</span><span class="operator">&gt;</span>contrastSlider<span class="operator">-</span><span class="operator">&gt;</span>setValue(<span class="type">int</span>(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>contrast() <span class="operator">*</span> SLIDER_RANGE));
     ui<span class="operator">-</span><span class="operator">&gt;</span>aspectCombo<span class="operator">-</span><span class="operator">&gt;</span>setCurrentIndex(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>aspectRatio());
     ui<span class="operator">-</span><span class="operator">&gt;</span>scalemodeCombo<span class="operator">-</span><span class="operator">&gt;</span>setCurrentIndex(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>scaleMode());
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>effectButton<span class="operator">,</span> SIGNAL(clicked())<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(configureEffect()));

 <span class="preprocessor">#ifdef Q_WS_X11</span>
     <span class="comment">//Cross fading is not currently implemented in the GStreamer backend</span>
     ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeSlider<span class="operator">-</span><span class="operator">&gt;</span>setVisible(<span class="keyword">false</span>);
     ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeLabel<span class="operator">-</span><span class="operator">&gt;</span>setVisible(<span class="keyword">false</span>);
     ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeLabel1<span class="operator">-</span><span class="operator">&gt;</span>setVisible(<span class="keyword">false</span>);
     ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeLabel2<span class="operator">-</span><span class="operator">&gt;</span>setVisible(<span class="keyword">false</span>);
     ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeLabel3<span class="operator">-</span><span class="operator">&gt;</span>setVisible(<span class="keyword">false</span>);
 <span class="preprocessor">#endif</span>
     ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeSlider<span class="operator">-</span><span class="operator">&gt;</span>setValue((<span class="type">int</span>)(<span class="number">2</span> <span class="operator">*</span> m_MediaObject<span class="operator">.</span>transitionTime() <span class="operator">/</span> <span class="number">1000.0f</span>));

     <span class="comment">// Insert audio devices:</span>
     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>AudioOutputDevice<span class="operator">&gt;</span> devices <span class="operator">=</span> Phonon<span class="operator">::</span>BackendCapabilities<span class="operator">::</span>availableAudioOutputDevices();
     <span class="keyword">for</span> (<span class="type">int</span> i<span class="operator">=</span><span class="number">0</span>; i<span class="operator">&lt;</span>devices<span class="operator">.</span>size(); i<span class="operator">+</span><span class="operator">+</span>){
         <span class="type"><a href="qstring.html">QString</a></span> itemText <span class="operator">=</span> devices<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>name();
         <span class="keyword">if</span> (<span class="operator">!</span>devices<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>description()<span class="operator">.</span>isEmpty()) {
             itemText <span class="operator">+</span><span class="operator">=</span> <span class="type"><a href="qstring.html">QString</a></span><span class="operator">::</span>fromLatin1(<span class="string">&quot; (%1)&quot;</span>)<span class="operator">.</span>arg(devices<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>description());
         }
         ui<span class="operator">-</span><span class="operator">&gt;</span>deviceCombo<span class="operator">-</span><span class="operator">&gt;</span>addItem(itemText);
         <span class="keyword">if</span> (devices<span class="operator">[</span>i<span class="operator">]</span> <span class="operator">=</span><span class="operator">=</span> m_AudioOutput<span class="operator">.</span>outputDevice())
             ui<span class="operator">-</span><span class="operator">&gt;</span>deviceCombo<span class="operator">-</span><span class="operator">&gt;</span>setCurrentIndex(i);
     }

     <span class="comment">// Insert audio effects:</span>
     ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>addItem(tr(<span class="string">&quot;&lt;no effect&gt;&quot;</span>));
     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>Effect <span class="operator">*</span><span class="operator">&gt;</span> currEffects <span class="operator">=</span> m_audioOutputPath<span class="operator">.</span>effects();
     Phonon<span class="operator">::</span>Effect <span class="operator">*</span>currEffect <span class="operator">=</span> currEffects<span class="operator">.</span>size() <span class="operator">?</span> currEffects<span class="operator">[</span><span class="number">0</span><span class="operator">]</span> : <span class="number">0</span>;
     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>EffectDescription<span class="operator">&gt;</span> availableEffects <span class="operator">=</span> Phonon<span class="operator">::</span>BackendCapabilities<span class="operator">::</span>availableAudioEffects();
     <span class="keyword">for</span> (<span class="type">int</span> i<span class="operator">=</span><span class="number">0</span>; i<span class="operator">&lt;</span>availableEffects<span class="operator">.</span>size(); i<span class="operator">+</span><span class="operator">+</span>){
         ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>addItem(availableEffects<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>name());
         <span class="keyword">if</span> (currEffect <span class="operator">&amp;</span><span class="operator">&amp;</span> availableEffects<span class="operator">[</span>i<span class="operator">]</span> <span class="operator">=</span><span class="operator">=</span> currEffect<span class="operator">-</span><span class="operator">&gt;</span>description())
             ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>setCurrentIndex(i<span class="operator">+</span><span class="number">1</span>);
     }
     connect(ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">,</span> SIGNAL(currentIndexChanged(<span class="type">int</span>))<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> SLOT(effectChanged()));

 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setVolume(<span class="type"><a href="qtglobal.html#qreal-typedef">qreal</a></span> volume)
 {
     m_AudioOutput<span class="operator">.</span>setVolume(volume);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setSmallScreen(<span class="type">bool</span> smallScreen)
 {
     m_smallScreen <span class="operator">=</span> smallScreen;
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>effectChanged()
 {
     <span class="type">int</span> currentIndex <span class="operator">=</span> ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>currentIndex();
     <span class="keyword">if</span> (currentIndex) {
         <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>EffectDescription<span class="operator">&gt;</span> availableEffects <span class="operator">=</span> Phonon<span class="operator">::</span>BackendCapabilities<span class="operator">::</span>availableAudioEffects();
         Phonon<span class="operator">::</span>EffectDescription chosenEffect <span class="operator">=</span> availableEffects<span class="operator">[</span>currentIndex <span class="operator">-</span> <span class="number">1</span><span class="operator">]</span>;

         <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>Effect <span class="operator">*</span><span class="operator">&gt;</span> currEffects <span class="operator">=</span> m_audioOutputPath<span class="operator">.</span>effects();
         Phonon<span class="operator">::</span>Effect <span class="operator">*</span>currentEffect <span class="operator">=</span> currEffects<span class="operator">.</span>size() <span class="operator">?</span> currEffects<span class="operator">[</span><span class="number">0</span><span class="operator">]</span> : <span class="number">0</span>;

         <span class="comment">// Deleting the running effect will stop playback, it is deleted when removed from path</span>
         <span class="keyword">if</span> (nextEffect <span class="operator">&amp;</span><span class="operator">&amp;</span> <span class="operator">!</span>(currentEffect <span class="operator">&amp;</span><span class="operator">&amp;</span> (currentEffect<span class="operator">-</span><span class="operator">&gt;</span>description()<span class="operator">.</span>name() <span class="operator">=</span><span class="operator">=</span> nextEffect<span class="operator">-</span><span class="operator">&gt;</span>description()<span class="operator">.</span>name())))
             <span class="keyword">delete</span> nextEffect;

         nextEffect <span class="operator">=</span> <span class="keyword">new</span> Phonon<span class="operator">::</span>Effect(chosenEffect);
     }
     ui<span class="operator">-</span><span class="operator">&gt;</span>effectButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(currentIndex);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>showSettingsDialog()
 {
     <span class="keyword">const</span> <span class="type">bool</span> hasPausedForDialog <span class="operator">=</span> playPauseForDialog();

     <span class="keyword">if</span> (<span class="operator">!</span>settingsDialog)
         initSettingsDialog();

     <span class="type">float</span> oldBrightness <span class="operator">=</span> m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>brightness();
     <span class="type">float</span> oldHue <span class="operator">=</span> m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>hue();
     <span class="type">float</span> oldSaturation <span class="operator">=</span> m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>saturation();
     <span class="type">float</span> oldContrast <span class="operator">=</span> m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>contrast();
     Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>AspectRatio oldAspect <span class="operator">=</span> m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>aspectRatio();
     Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>ScaleMode oldScale <span class="operator">=</span> m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>scaleMode();
     <span class="type">int</span> currentEffect <span class="operator">=</span> ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>currentIndex();
     settingsDialog<span class="operator">-</span><span class="operator">&gt;</span>exec();

     <span class="keyword">if</span> (settingsDialog<span class="operator">-</span><span class="operator">&gt;</span>result() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qdialog.html">QDialog</a></span><span class="operator">::</span>Accepted){
         m_MediaObject<span class="operator">.</span>setTransitionTime((<span class="type">int</span>)(<span class="number">1000</span> <span class="operator">*</span> <span class="type">float</span>(ui<span class="operator">-</span><span class="operator">&gt;</span>crossFadeSlider<span class="operator">-</span><span class="operator">&gt;</span>value()) <span class="operator">/</span> <span class="number">2.0f</span>));
         <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>AudioOutputDevice<span class="operator">&gt;</span> devices <span class="operator">=</span> Phonon<span class="operator">::</span>BackendCapabilities<span class="operator">::</span>availableAudioOutputDevices();
         m_AudioOutput<span class="operator">.</span>setOutputDevice(devices<span class="operator">[</span>ui<span class="operator">-</span><span class="operator">&gt;</span>deviceCombo<span class="operator">-</span><span class="operator">&gt;</span>currentIndex()<span class="operator">]</span>);
         <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>Effect <span class="operator">*</span><span class="operator">&gt;</span> currEffects <span class="operator">=</span> m_audioOutputPath<span class="operator">.</span>effects();
         <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>EffectDescription<span class="operator">&gt;</span> availableEffects <span class="operator">=</span> Phonon<span class="operator">::</span>BackendCapabilities<span class="operator">::</span>availableAudioEffects();

         <span class="keyword">if</span> (ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>currentIndex() <span class="operator">&gt;</span> <span class="number">0</span>){
             Phonon<span class="operator">::</span>Effect <span class="operator">*</span>currentEffect <span class="operator">=</span> currEffects<span class="operator">.</span>size() <span class="operator">?</span> currEffects<span class="operator">[</span><span class="number">0</span><span class="operator">]</span> : <span class="number">0</span>;
             <span class="keyword">if</span> (<span class="operator">!</span>currentEffect <span class="operator">|</span><span class="operator">|</span> currentEffect<span class="operator">-</span><span class="operator">&gt;</span>description() <span class="operator">!</span><span class="operator">=</span> nextEffect<span class="operator">-</span><span class="operator">&gt;</span>description()){
                 foreach(Phonon<span class="operator">::</span>Effect <span class="operator">*</span>effect<span class="operator">,</span> currEffects) {
                     m_audioOutputPath<span class="operator">.</span>removeEffect(effect);
                     <span class="keyword">delete</span> effect;
                 }
                 m_audioOutputPath<span class="operator">.</span>insertEffect(nextEffect);
             }
         } <span class="keyword">else</span> {
             foreach(Phonon<span class="operator">::</span>Effect <span class="operator">*</span>effect<span class="operator">,</span> currEffects) {
                 m_audioOutputPath<span class="operator">.</span>removeEffect(effect);
                 <span class="keyword">delete</span> effect;
                 nextEffect <span class="operator">=</span> <span class="number">0</span>;
             }
         }
     } <span class="keyword">else</span> {
         <span class="comment">// Restore previous settings</span>
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setBrightness(oldBrightness);
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setSaturation(oldSaturation);
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setHue(oldHue);
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setContrast(oldContrast);
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setAspectRatio(oldAspect);
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setScaleMode(oldScale);
         ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>setCurrentIndex(currentEffect);
     }

     <span class="keyword">if</span> (hasPausedForDialog)
         m_MediaObject<span class="operator">.</span>play();
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>initVideoWindow()
 {
     <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span> <span class="operator">*</span>videoLayout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span>();
     videoLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(m_videoWidget);
     videoLayout<span class="operator">-</span><span class="operator">&gt;</span>setContentsMargins(<span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span>);
     m_videoWindow<span class="operator">.</span>setLayout(videoLayout);
     m_videoWindow<span class="operator">.</span>setMinimumSize(<span class="number">100</span><span class="operator">,</span> <span class="number">100</span>);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>configureEffect()
 {
     <span class="keyword">if</span> (<span class="operator">!</span>nextEffect)
         <span class="keyword">return</span>;

     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>Effect <span class="operator">*</span><span class="operator">&gt;</span> currEffects <span class="operator">=</span> m_audioOutputPath<span class="operator">.</span>effects();
     <span class="keyword">const</span> <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>EffectDescription<span class="operator">&gt;</span> availableEffects <span class="operator">=</span> Phonon<span class="operator">::</span>BackendCapabilities<span class="operator">::</span>availableAudioEffects();
     <span class="keyword">if</span> (ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>currentIndex() <span class="operator">&gt;</span> <span class="number">0</span>) {
         Phonon<span class="operator">::</span>EffectDescription chosenEffect <span class="operator">=</span> availableEffects<span class="operator">[</span>ui<span class="operator">-</span><span class="operator">&gt;</span>audioEffectsCombo<span class="operator">-</span><span class="operator">&gt;</span>currentIndex() <span class="operator">-</span> <span class="number">1</span><span class="operator">]</span>;

         <span class="type"><a href="qdialog.html">QDialog</a></span> effectDialog;
         effectDialog<span class="operator">.</span>setWindowTitle(tr(<span class="string">&quot;Configure effect&quot;</span>));
         <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span> <span class="operator">*</span>topLayout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qvboxlayout.html">QVBoxLayout</a></span>(<span class="operator">&amp;</span>effectDialog);

         <span class="type"><a href="qlabel.html">QLabel</a></span> <span class="operator">*</span>description <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qlabel.html">QLabel</a></span>(<span class="string">&quot;&lt;b&gt;Description:&lt;/b&gt;&lt;br&gt;&quot;</span> <span class="operator">+</span> chosenEffect<span class="operator">.</span>description()<span class="operator">,</span> <span class="operator">&amp;</span>effectDialog);
         description<span class="operator">-</span><span class="operator">&gt;</span>setWordWrap(<span class="keyword">true</span>);
         topLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(description);

         <span class="type"><a href="qscrollarea.html">QScrollArea</a></span> <span class="operator">*</span>scrollArea <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qscrollarea.html">QScrollArea</a></span>(<span class="operator">&amp;</span>effectDialog);
         topLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(scrollArea);

         <span class="type"><a href="qvariant.html#QVariantList-typedef">QVariantList</a></span> savedParamValues;
         foreach(Phonon<span class="operator">::</span>EffectParameter param<span class="operator">,</span> nextEffect<span class="operator">-</span><span class="operator">&gt;</span>parameters()) {
             savedParamValues <span class="operator">&lt;</span><span class="operator">&lt;</span> nextEffect<span class="operator">-</span><span class="operator">&gt;</span>parameterValue(param);
         }

         <span class="type"><a href="qwidget.html">QWidget</a></span> <span class="operator">*</span>scrollWidget <span class="operator">=</span> <span class="keyword">new</span> Phonon<span class="operator">::</span>EffectWidget(nextEffect);
         scrollWidget<span class="operator">-</span><span class="operator">&gt;</span>setMinimumWidth(<span class="number">320</span>);
         scrollWidget<span class="operator">-</span><span class="operator">&gt;</span>setContentsMargins(<span class="number">10</span><span class="operator">,</span> <span class="number">10</span><span class="operator">,</span> <span class="number">10</span><span class="operator">,</span><span class="number">10</span>);
         scrollArea<span class="operator">-</span><span class="operator">&gt;</span>setWidget(scrollWidget);

         <span class="type"><a href="qdialogbuttonbox.html">QDialogButtonBox</a></span> <span class="operator">*</span>bbox <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qdialogbuttonbox.html">QDialogButtonBox</a></span>(<span class="type"><a href="qdialogbuttonbox.html">QDialogButtonBox</a></span><span class="operator">::</span>Ok <span class="operator">|</span> <span class="type"><a href="qdialogbuttonbox.html">QDialogButtonBox</a></span><span class="operator">::</span>Cancel<span class="operator">,</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>Horizontal<span class="operator">,</span> <span class="operator">&amp;</span>effectDialog);
         connect(bbox<span class="operator">-</span><span class="operator">&gt;</span>button(<span class="type"><a href="qdialogbuttonbox.html">QDialogButtonBox</a></span><span class="operator">::</span>Ok)<span class="operator">,</span> SIGNAL(clicked())<span class="operator">,</span> <span class="operator">&amp;</span>effectDialog<span class="operator">,</span> SLOT(accept()));
         connect(bbox<span class="operator">-</span><span class="operator">&gt;</span>button(<span class="type"><a href="qdialogbuttonbox.html">QDialogButtonBox</a></span><span class="operator">::</span>Cancel)<span class="operator">,</span> SIGNAL(clicked())<span class="operator">,</span> <span class="operator">&amp;</span>effectDialog<span class="operator">,</span> SLOT(reject()));
         topLayout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(bbox);

         effectDialog<span class="operator">.</span>exec();

         <span class="keyword">if</span> (effectDialog<span class="operator">.</span>result() <span class="operator">!</span><span class="operator">=</span> <span class="type"><a href="qdialog.html">QDialog</a></span><span class="operator">::</span>Accepted) {
             <span class="comment">//we need to restore the parameters values</span>
             <span class="type">int</span> currentIndex <span class="operator">=</span> <span class="number">0</span>;
             foreach(Phonon<span class="operator">::</span>EffectParameter param<span class="operator">,</span> nextEffect<span class="operator">-</span><span class="operator">&gt;</span>parameters()) {
                 nextEffect<span class="operator">-</span><span class="operator">&gt;</span>setParameterValue(param<span class="operator">,</span> savedParamValues<span class="operator">.</span>at(currentIndex<span class="operator">+</span><span class="operator">+</span>));
             }

         }
     }
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>handleDrop(<span class="type"><a href="qdropevent.html">QDropEvent</a></span> <span class="operator">*</span>e)
 {
     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="qurl.html">QUrl</a></span><span class="operator">&gt;</span> urls <span class="operator">=</span> e<span class="operator">-</span><span class="operator">&gt;</span>mimeData()<span class="operator">-</span><span class="operator">&gt;</span>urls();
     <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>proposedAction() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>MoveAction){
         <span class="comment">// Just add to the queue:</span>
         <span class="keyword">for</span> (<span class="type">int</span> i<span class="operator">=</span><span class="number">0</span>; i<span class="operator">&lt;</span>urls<span class="operator">.</span>size(); i<span class="operator">+</span><span class="operator">+</span>)
             m_MediaObject<span class="operator">.</span>enqueue(Phonon<span class="operator">::</span>MediaSource(urls<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>toLocalFile()));
     } <span class="keyword">else</span> {
         <span class="comment">// Create new queue:</span>
         m_MediaObject<span class="operator">.</span>clearQueue();
         <span class="keyword">if</span> (urls<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">0</span>) {
             <span class="type"><a href="qstring.html">QString</a></span> fileName <span class="operator">=</span> urls<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toLocalFile();
             <span class="type"><a href="qdir.html">QDir</a></span> dir(fileName);
             <span class="keyword">if</span> (dir<span class="operator">.</span>exists()) {
                 dir<span class="operator">.</span>setFilter(<span class="type"><a href="qdir.html">QDir</a></span><span class="operator">::</span>Files);
                 <span class="type"><a href="qstringlist.html">QStringList</a></span> entries <span class="operator">=</span> dir<span class="operator">.</span>entryList();
                 <span class="keyword">if</span> (entries<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">0</span>) {
                     setFile(fileName <span class="operator">+</span> <span class="type"><a href="qdir.html">QDir</a></span><span class="operator">::</span>separator() <span class="operator">+</span>  entries<span class="operator">[</span><span class="number">0</span><span class="operator">]</span>);
                     <span class="keyword">for</span> (<span class="type">int</span> i<span class="operator">=</span><span class="number">1</span>; i<span class="operator">&lt;</span> entries<span class="operator">.</span>size(); <span class="operator">+</span><span class="operator">+</span>i)
                         m_MediaObject<span class="operator">.</span>enqueue(fileName <span class="operator">+</span> <span class="type"><a href="qdir.html">QDir</a></span><span class="operator">::</span>separator() <span class="operator">+</span> entries<span class="operator">[</span>i<span class="operator">]</span>);
                 }
             } <span class="keyword">else</span> {
                 setFile(fileName);
                 <span class="keyword">for</span> (<span class="type">int</span> i<span class="operator">=</span><span class="number">1</span>; i<span class="operator">&lt;</span>urls<span class="operator">.</span>size(); i<span class="operator">+</span><span class="operator">+</span>)
                     m_MediaObject<span class="operator">.</span>enqueue(Phonon<span class="operator">::</span>MediaSource(urls<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>toLocalFile()));
             }
         }
     }
     forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(m_MediaObject<span class="operator">.</span>queue()<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">0</span>);
     m_MediaObject<span class="operator">.</span>play();
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>dropEvent(<span class="type"><a href="qdropevent.html">QDropEvent</a></span> <span class="operator">*</span>e)
 {
     <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>mimeData()<span class="operator">-</span><span class="operator">&gt;</span>hasUrls() <span class="operator">&amp;</span><span class="operator">&amp;</span> e<span class="operator">-</span><span class="operator">&gt;</span>proposedAction() <span class="operator">!</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>LinkAction) {
         e<span class="operator">-</span><span class="operator">&gt;</span>acceptProposedAction();
         handleDrop(e);
     } <span class="keyword">else</span> {
         e<span class="operator">-</span><span class="operator">&gt;</span>ignore();
     }
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>dragEnterEvent(<span class="type"><a href="qdragenterevent.html">QDragEnterEvent</a></span> <span class="operator">*</span>e)
 {
     dragMoveEvent(e);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>dragMoveEvent(<span class="type"><a href="qdragmoveevent.html">QDragMoveEvent</a></span> <span class="operator">*</span>e)
 {
     <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>mimeData()<span class="operator">-</span><span class="operator">&gt;</span>hasUrls()) {
         <span class="keyword">if</span> (e<span class="operator">-</span><span class="operator">&gt;</span>proposedAction() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>CopyAction <span class="operator">|</span><span class="operator">|</span> e<span class="operator">-</span><span class="operator">&gt;</span>proposedAction() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>MoveAction){
             e<span class="operator">-</span><span class="operator">&gt;</span>acceptProposedAction();
         }
     }
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>playPause()
 {
     <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>state() <span class="operator">=</span><span class="operator">=</span> Phonon<span class="operator">::</span>PlayingState)
         m_MediaObject<span class="operator">.</span>pause();
     <span class="keyword">else</span> {
         <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>currentTime() <span class="operator">=</span><span class="operator">=</span> m_MediaObject<span class="operator">.</span>totalTime())
             m_MediaObject<span class="operator">.</span>seek(<span class="number">0</span>);
         m_MediaObject<span class="operator">.</span>play();
     }
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setFile(<span class="keyword">const</span> <span class="type"><a href="qstring.html">QString</a></span> <span class="operator">&amp;</span>fileName)
 {
     setWindowTitle(fileName<span class="operator">.</span>right(fileName<span class="operator">.</span>length() <span class="operator">-</span> fileName<span class="operator">.</span>lastIndexOf(<span class="char">'/'</span>) <span class="operator">-</span> <span class="number">1</span>));
     m_MediaObject<span class="operator">.</span>setCurrentSource(Phonon<span class="operator">::</span>MediaSource(fileName));
     m_MediaObject<span class="operator">.</span>play();
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setLocation(<span class="keyword">const</span> <span class="type"><a href="qstring.html">QString</a></span><span class="operator">&amp;</span> location)
 {
     setWindowTitle(location<span class="operator">.</span>right(location<span class="operator">.</span>length() <span class="operator">-</span> location<span class="operator">.</span>lastIndexOf(<span class="char">'/'</span>) <span class="operator">-</span> <span class="number">1</span>));
     m_MediaObject<span class="operator">.</span>setCurrentSource(Phonon<span class="operator">::</span>MediaSource(<span class="type"><a href="qurl.html">QUrl</a></span><span class="operator">::</span>fromEncoded(location<span class="operator">.</span>toUtf8())));
     m_MediaObject<span class="operator">.</span>play();
 }

 <span class="type">bool</span> MediaPlayer<span class="operator">::</span>playPauseForDialog()
 {
     <span class="comment">// If we're running on a small screen, we want to pause the video when</span>
     <span class="comment">// popping up dialogs. We neither want to tamper with the state if the</span>
     <span class="comment">// user has paused.</span>
     <span class="keyword">if</span> (m_smallScreen <span class="operator">&amp;</span><span class="operator">&amp;</span> m_MediaObject<span class="operator">.</span>hasVideo()) {
         <span class="keyword">if</span> (Phonon<span class="operator">::</span>PlayingState <span class="operator">=</span><span class="operator">=</span> m_MediaObject<span class="operator">.</span>state()) {
             m_MediaObject<span class="operator">.</span>pause();
             <span class="keyword">return</span> <span class="keyword">true</span>;
         }
     }
     <span class="keyword">return</span> <span class="keyword">false</span>;
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>openFile()
 {
     <span class="keyword">const</span> <span class="type">bool</span> hasPausedForDialog <span class="operator">=</span> playPauseForDialog();

     <span class="type"><a href="qstringlist.html">QStringList</a></span> fileNames <span class="operator">=</span> <span class="type"><a href="qfiledialog.html">QFileDialog</a></span><span class="operator">::</span>getOpenFileNames(<span class="keyword">this</span><span class="operator">,</span> <span class="type"><a href="qstring.html">QString</a></span>()<span class="operator">,</span>
                                                           <span class="type"><a href="qdesktopservices.html">QDesktopServices</a></span><span class="operator">::</span>storageLocation(<span class="type"><a href="qdesktopservices.html">QDesktopServices</a></span><span class="operator">::</span>MusicLocation));

     <span class="keyword">if</span> (hasPausedForDialog)
         m_MediaObject<span class="operator">.</span>play();

     m_MediaObject<span class="operator">.</span>clearQueue();
     <span class="keyword">if</span> (fileNames<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">0</span>) {
         <span class="type"><a href="qstring.html">QString</a></span> fileName <span class="operator">=</span> fileNames<span class="operator">[</span><span class="number">0</span><span class="operator">]</span>;
         setFile(fileName);
         <span class="keyword">for</span> (<span class="type">int</span> i<span class="operator">=</span><span class="number">1</span>; i<span class="operator">&lt;</span>fileNames<span class="operator">.</span>size(); i<span class="operator">+</span><span class="operator">+</span>)
             m_MediaObject<span class="operator">.</span>enqueue(Phonon<span class="operator">::</span>MediaSource(fileNames<span class="operator">[</span>i<span class="operator">]</span>));
     }
     forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(m_MediaObject<span class="operator">.</span>queue()<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">0</span>);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>bufferStatus(<span class="type">int</span> percent)
 {
     <span class="keyword">if</span> (percent <span class="operator">=</span><span class="operator">=</span> <span class="number">100</span>)
         progressLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(<span class="type"><a href="qstring.html">QString</a></span>());
     <span class="keyword">else</span> {
         <span class="type"><a href="qstring.html">QString</a></span> str <span class="operator">=</span> <span class="type"><a href="qstring.html">QString</a></span><span class="operator">::</span>fromLatin1(<span class="string">&quot;(%1%)&quot;</span>)<span class="operator">.</span>arg(percent);
         progressLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(str);
     }
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setSaturation(<span class="type">int</span> val)
 {
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setSaturation(val <span class="operator">/</span> <span class="type"><a href="qtglobal.html#qreal-typedef">qreal</a></span>(SLIDER_RANGE));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setHue(<span class="type">int</span> val)
 {
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setHue(val <span class="operator">/</span> <span class="type"><a href="qtglobal.html#qreal-typedef">qreal</a></span>(SLIDER_RANGE));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setAspect(<span class="type">int</span> val)
 {
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setAspectRatio(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>AspectRatio(val));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setScale(<span class="type">int</span> val)
 {
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setScaleMode(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>ScaleMode(val));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setBrightness(<span class="type">int</span> val)
 {
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setBrightness(val <span class="operator">/</span> <span class="type"><a href="qtglobal.html#qreal-typedef">qreal</a></span>(SLIDER_RANGE));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>setContrast(<span class="type">int</span> val)
 {
     m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setContrast(val <span class="operator">/</span> <span class="type"><a href="qtglobal.html#qreal-typedef">qreal</a></span>(SLIDER_RANGE));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>updateInfo()
 {
     <span class="type">int</span> maxLength <span class="operator">=</span> <span class="number">30</span>;
     <span class="type"><a href="qstring.html">QString</a></span> font <span class="operator">=</span> <span class="string">&quot;&lt;font color=#ffeeaa&gt;&quot;</span>;
     <span class="type"><a href="qstring.html">QString</a></span> fontmono <span class="operator">=</span> <span class="string">&quot;&lt;font family=\&quot;monospace,courier new\&quot; color=#ffeeaa&gt;&quot;</span>;

     <span class="type"><a href="qmap.html">QMap</a></span> <span class="operator">&lt;</span><span class="type"><a href="qstring.html">QString</a></span><span class="operator">,</span> <span class="type"><a href="qstring.html">QString</a></span><span class="operator">&gt;</span> metaData <span class="operator">=</span> m_MediaObject<span class="operator">.</span>metaData();
     <span class="type"><a href="qstring.html">QString</a></span> trackArtist <span class="operator">=</span> metaData<span class="operator">.</span>value(<span class="string">&quot;ARTIST&quot;</span>);
     <span class="keyword">if</span> (trackArtist<span class="operator">.</span>length() <span class="operator">&gt;</span> maxLength)
         trackArtist <span class="operator">=</span> trackArtist<span class="operator">.</span>left(maxLength) <span class="operator">+</span> <span class="string">&quot;...&quot;</span>;

     <span class="type"><a href="qstring.html">QString</a></span> trackTitle <span class="operator">=</span> metaData<span class="operator">.</span>value(<span class="string">&quot;TITLE&quot;</span>);
     <span class="type">int</span> trackBitrate <span class="operator">=</span> metaData<span class="operator">.</span>value(<span class="string">&quot;BITRATE&quot;</span>)<span class="operator">.</span>toInt();

     <span class="type"><a href="qstring.html">QString</a></span> fileName;
     <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>currentSource()<span class="operator">.</span>type() <span class="operator">=</span><span class="operator">=</span> Phonon<span class="operator">::</span>MediaSource<span class="operator">::</span>Url) {
         fileName <span class="operator">=</span> m_MediaObject<span class="operator">.</span>currentSource()<span class="operator">.</span>url()<span class="operator">.</span>toString();
     } <span class="keyword">else</span> {
         fileName <span class="operator">=</span> m_MediaObject<span class="operator">.</span>currentSource()<span class="operator">.</span>fileName();
         fileName <span class="operator">=</span> fileName<span class="operator">.</span>right(fileName<span class="operator">.</span>length() <span class="operator">-</span> fileName<span class="operator">.</span>lastIndexOf(<span class="char">'/'</span>) <span class="operator">-</span> <span class="number">1</span>);
         <span class="keyword">if</span> (fileName<span class="operator">.</span>length() <span class="operator">&gt;</span> maxLength)
             fileName <span class="operator">=</span> fileName<span class="operator">.</span>left(maxLength) <span class="operator">+</span> <span class="string">&quot;...&quot;</span>;
     }

     <span class="type"><a href="qstring.html">QString</a></span> title;
     <span class="keyword">if</span> (<span class="operator">!</span>trackTitle<span class="operator">.</span>isEmpty()) {
         <span class="keyword">if</span> (trackTitle<span class="operator">.</span>length() <span class="operator">&gt;</span> maxLength)
             trackTitle <span class="operator">=</span> trackTitle<span class="operator">.</span>left(maxLength) <span class="operator">+</span> <span class="string">&quot;...&quot;</span>;
         title <span class="operator">=</span> <span class="string">&quot;Title: &quot;</span> <span class="operator">+</span> font <span class="operator">+</span> trackTitle <span class="operator">+</span> <span class="string">&quot;&lt;br&gt;&lt;/font&gt;&quot;</span>;
     } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="operator">!</span>fileName<span class="operator">.</span>isEmpty()) {
         <span class="keyword">if</span> (fileName<span class="operator">.</span>length() <span class="operator">&gt;</span> maxLength)
             fileName <span class="operator">=</span> fileName<span class="operator">.</span>left(maxLength) <span class="operator">+</span> <span class="string">&quot;...&quot;</span>;
         title <span class="operator">=</span> font <span class="operator">+</span> fileName <span class="operator">+</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;
         <span class="keyword">if</span> (m_MediaObject<span class="operator">.</span>currentSource()<span class="operator">.</span>type() <span class="operator">=</span><span class="operator">=</span> Phonon<span class="operator">::</span>MediaSource<span class="operator">::</span>Url) {
             title<span class="operator">.</span>prepend(<span class="string">&quot;Url: &quot;</span>);
         } <span class="keyword">else</span> {
             title<span class="operator">.</span>prepend(<span class="string">&quot;File: &quot;</span>);
         }
     }

     <span class="type"><a href="qstring.html">QString</a></span> artist;
     <span class="keyword">if</span> (<span class="operator">!</span>trackArtist<span class="operator">.</span>isEmpty())
         artist <span class="operator">=</span> <span class="string">&quot;Artist:  &quot;</span> <span class="operator">+</span> font <span class="operator">+</span> trackArtist <span class="operator">+</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;

     <span class="type"><a href="qstring.html">QString</a></span> bitrate;
     <span class="keyword">if</span> (trackBitrate <span class="operator">!</span><span class="operator">=</span> <span class="number">0</span>)
         bitrate <span class="operator">=</span> <span class="string">&quot;&lt;br&gt;Bitrate:  &quot;</span> <span class="operator">+</span> font <span class="operator">+</span> <span class="type"><a href="qstring.html">QString</a></span><span class="operator">::</span>number(trackBitrate<span class="operator">/</span><span class="number">1000</span>) <span class="operator">+</span> <span class="string">&quot;kbit&lt;/font&gt;&quot;</span>;

     info<span class="operator">-</span><span class="operator">&gt;</span>setText(title <span class="operator">+</span> artist <span class="operator">+</span> bitrate);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>updateTime()
 {
     <span class="type">long</span> len <span class="operator">=</span> m_MediaObject<span class="operator">.</span>totalTime();
     <span class="type">long</span> pos <span class="operator">=</span> m_MediaObject<span class="operator">.</span>currentTime();
     <span class="type"><a href="qstring.html">QString</a></span> timeString;
     <span class="keyword">if</span> (pos <span class="operator">|</span><span class="operator">|</span> len)
     {
         <span class="type">int</span> sec <span class="operator">=</span> pos<span class="operator">/</span><span class="number">1000</span>;
         <span class="type">int</span> min <span class="operator">=</span> sec<span class="operator">/</span><span class="number">60</span>;
         <span class="type">int</span> hour <span class="operator">=</span> min<span class="operator">/</span><span class="number">60</span>;
         <span class="type">int</span> msec <span class="operator">=</span> pos;

         <span class="type"><a href="qtime.html">QTime</a></span> playTime(hour<span class="operator">%</span><span class="number">60</span><span class="operator">,</span> min<span class="operator">%</span><span class="number">60</span><span class="operator">,</span> sec<span class="operator">%</span><span class="number">60</span><span class="operator">,</span> msec<span class="operator">%</span><span class="number">1000</span>);
         sec <span class="operator">=</span> len <span class="operator">/</span> <span class="number">1000</span>;
         min <span class="operator">=</span> sec <span class="operator">/</span> <span class="number">60</span>;
         hour <span class="operator">=</span> min <span class="operator">/</span> <span class="number">60</span>;
         msec <span class="operator">=</span> len;

         <span class="type"><a href="qtime.html">QTime</a></span> stopTime(hour<span class="operator">%</span><span class="number">60</span><span class="operator">,</span> min<span class="operator">%</span><span class="number">60</span><span class="operator">,</span> sec<span class="operator">%</span><span class="number">60</span><span class="operator">,</span> msec<span class="operator">%</span><span class="number">1000</span>);
         <span class="type"><a href="qstring.html">QString</a></span> timeFormat <span class="operator">=</span> <span class="string">&quot;m:ss&quot;</span>;
         <span class="keyword">if</span> (hour <span class="operator">&gt;</span> <span class="number">0</span>)
             timeFormat <span class="operator">=</span> <span class="string">&quot;h:mm:ss&quot;</span>;
         timeString <span class="operator">=</span> playTime<span class="operator">.</span>toString(timeFormat);
         <span class="keyword">if</span> (len)
             timeString <span class="operator">+</span><span class="operator">=</span> <span class="string">&quot; / &quot;</span> <span class="operator">+</span> stopTime<span class="operator">.</span>toString(timeFormat);
     }
     timeLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(timeString);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>rewind()
 {
     m_MediaObject<span class="operator">.</span>seek(<span class="number">0</span>);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>forward()
 {
     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span>Phonon<span class="operator">::</span>MediaSource<span class="operator">&gt;</span> queue <span class="operator">=</span> m_MediaObject<span class="operator">.</span>queue();
     <span class="keyword">if</span> (queue<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">0</span>) {
         m_MediaObject<span class="operator">.</span>setCurrentSource(queue<span class="operator">[</span><span class="number">0</span><span class="operator">]</span>);
         forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(queue<span class="operator">.</span>size() <span class="operator">&gt;</span> <span class="number">1</span>);
         m_MediaObject<span class="operator">.</span>play();
     }
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>openUrl()
 {
     <span class="type"><a href="qsettings.html">QSettings</a></span> settings;
     settings<span class="operator">.</span>beginGroup(QLatin1String(<span class="string">&quot;BrowserMainWindow&quot;</span>));
     <span class="type"><a href="qstring.html">QString</a></span> sourceURL <span class="operator">=</span> settings<span class="operator">.</span>value(<span class="string">&quot;location&quot;</span>)<span class="operator">.</span>toString();
     <span class="type">bool</span> ok <span class="operator">=</span> <span class="keyword">false</span>;
     sourceURL <span class="operator">=</span> <span class="type"><a href="qinputdialog.html">QInputDialog</a></span><span class="operator">::</span>getText(<span class="keyword">this</span><span class="operator">,</span> tr(<span class="string">&quot;Open Location&quot;</span>)<span class="operator">,</span> tr(<span class="string">&quot;Please enter a valid address here:&quot;</span>)<span class="operator">,</span> <span class="type"><a href="qlineedit.html">QLineEdit</a></span><span class="operator">::</span>Normal<span class="operator">,</span> sourceURL<span class="operator">,</span> <span class="operator">&amp;</span>ok);
     <span class="keyword">if</span> (ok <span class="operator">&amp;</span><span class="operator">&amp;</span> <span class="operator">!</span>sourceURL<span class="operator">.</span>isEmpty()) {
         setLocation(sourceURL);
         settings<span class="operator">.</span>setValue(<span class="string">&quot;location&quot;</span><span class="operator">,</span> sourceURL);
     }
 }

 <span class="comment">/*!
  \since 4.6
  */</span>
 <span class="type">void</span> MediaPlayer<span class="operator">::</span>openRamFile()
 {
     <span class="type"><a href="qsettings.html">QSettings</a></span> settings;
     settings<span class="operator">.</span>beginGroup(QLatin1String(<span class="string">&quot;BrowserMainWindow&quot;</span>));

     <span class="keyword">const</span> <span class="type"><a href="qstringlist.html">QStringList</a></span> fileNameList(<span class="type"><a href="qfiledialog.html">QFileDialog</a></span><span class="operator">::</span>getOpenFileNames(<span class="keyword">this</span><span class="operator">,</span>
                                                                   <span class="type"><a href="qstring.html">QString</a></span>()<span class="operator">,</span>
                                                                   settings<span class="operator">.</span>value(<span class="string">&quot;openRamFile&quot;</span>)<span class="operator">.</span>toString()<span class="operator">,</span>
                                                                   QLatin1String(<span class="string">&quot;RAM files (*.ram)&quot;</span>)));

     <span class="keyword">if</span> (fileNameList<span class="operator">.</span>isEmpty())
         <span class="keyword">return</span>;

     <span class="type"><a href="qfile.html">QFile</a></span> linkFile;
     <span class="type"><a href="qlist.html">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="qurl.html">QUrl</a></span><span class="operator">&gt;</span> list;
     <span class="type"><a href="qbytearray.html">QByteArray</a></span> sourceURL;
     <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">0</span>; i <span class="operator">&lt;</span> fileNameList<span class="operator">.</span>count(); i<span class="operator">+</span><span class="operator">+</span> ) {
         linkFile<span class="operator">.</span>setFileName(fileNameList<span class="operator">[</span>i<span class="operator">]</span>);
         <span class="keyword">if</span> (linkFile<span class="operator">.</span>open(<span class="type"><a href="qiodevice.html">QIODevice</a></span><span class="operator">::</span>ReadOnly <span class="operator">|</span> <span class="type"><a href="qiodevice.html">QIODevice</a></span><span class="operator">::</span>Text)) {
             <span class="keyword">while</span> (<span class="operator">!</span>linkFile<span class="operator">.</span>atEnd()) {
                 sourceURL <span class="operator">=</span> linkFile<span class="operator">.</span>readLine()<span class="operator">.</span>trimmed();
                 <span class="keyword">if</span> (<span class="operator">!</span>sourceURL<span class="operator">.</span>isEmpty()) {
                     <span class="keyword">const</span> <span class="type"><a href="qurl.html">QUrl</a></span> url(<span class="type"><a href="qurl.html">QUrl</a></span><span class="operator">::</span>fromEncoded(sourceURL));
                     <span class="keyword">if</span> (url<span class="operator">.</span>isValid())
                         list<span class="operator">.</span>append(url);
                 }
             }
             linkFile<span class="operator">.</span>close();
         }
     }

     <span class="keyword">if</span> (<span class="operator">!</span>list<span class="operator">.</span>isEmpty()) {
         m_MediaObject<span class="operator">.</span>clearQueue();
         setLocation(list<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toString());
         <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">1</span>; i <span class="operator">&lt;</span> list<span class="operator">.</span>count(); i<span class="operator">+</span><span class="operator">+</span>)
             m_MediaObject<span class="operator">.</span>enqueue(Phonon<span class="operator">::</span>MediaSource(list<span class="operator">[</span>i<span class="operator">]</span>));
         m_MediaObject<span class="operator">.</span>play();
     }

     forwardButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="operator">!</span>m_MediaObject<span class="operator">.</span>queue()<span class="operator">.</span>isEmpty());
     settings<span class="operator">.</span>setValue(<span class="string">&quot;openRamFile&quot;</span><span class="operator">,</span> fileNameList<span class="operator">[</span><span class="number">0</span><span class="operator">]</span>);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>finished()
 {
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>showContextMenu(<span class="keyword">const</span> <span class="type"><a href="qpoint.html">QPoint</a></span> <span class="operator">&amp;</span>p)
 {
     fileMenu<span class="operator">-</span><span class="operator">&gt;</span>popup(m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>isFullScreen() <span class="operator">?</span> p : mapToGlobal(p));
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>scaleChanged(<span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>act)
 {
     <span class="keyword">if</span> (act<span class="operator">-</span><span class="operator">&gt;</span>text() <span class="operator">=</span><span class="operator">=</span> tr(<span class="string">&quot;Scale and crop&quot;</span>))
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setScaleMode(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>ScaleAndCrop);
     <span class="keyword">else</span>
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setScaleMode(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>FitInView);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>aspectChanged(<span class="type"><a href="qaction.html">QAction</a></span> <span class="operator">*</span>act)
 {
     <span class="keyword">if</span> (act<span class="operator">-</span><span class="operator">&gt;</span>text() <span class="operator">=</span><span class="operator">=</span> tr(<span class="string">&quot;16/9&quot;</span>))
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setAspectRatio(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>AspectRatio16_9);
     <span class="keyword">else</span> <span class="keyword">if</span> (act<span class="operator">-</span><span class="operator">&gt;</span>text() <span class="operator">=</span><span class="operator">=</span> tr(<span class="string">&quot;Scale&quot;</span>))
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setAspectRatio(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>AspectRatioWidget);
     <span class="keyword">else</span> <span class="keyword">if</span> (act<span class="operator">-</span><span class="operator">&gt;</span>text() <span class="operator">=</span><span class="operator">=</span> tr(<span class="string">&quot;4/3&quot;</span>))
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setAspectRatio(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>AspectRatio4_3);
     <span class="keyword">else</span>
         m_videoWidget<span class="operator">-</span><span class="operator">&gt;</span>setAspectRatio(Phonon<span class="operator">::</span>VideoWidget<span class="operator">::</span>AspectRatioAuto);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>hasVideoChanged(<span class="type">bool</span> bHasVideo)
 {
     info<span class="operator">-</span><span class="operator">&gt;</span>setVisible(<span class="operator">!</span>bHasVideo);
     m_videoWindow<span class="operator">.</span>setVisible(bHasVideo);
     m_fullScreenAction<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(bHasVideo);
 }

 <span class="preprocessor">#ifdef Q_OS_SYMBIAN</span>
 <span class="type">void</span> MediaPlayer<span class="operator">::</span>selectIAP()
 {
     TRAPD(err<span class="operator">,</span> selectIAPL());
     <span class="keyword">if</span> (KErrNone <span class="operator">!</span><span class="operator">=</span> err)
         <span class="type"><a href="qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>warning(<span class="keyword">this</span><span class="operator">,</span> <span class="string">&quot;Phonon Mediaplayer&quot;</span><span class="operator">,</span> <span class="string">&quot;Error selecting IAP&quot;</span><span class="operator">,</span> <span class="type"><a href="qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>Close);
 }

 <span class="type">void</span> MediaPlayer<span class="operator">::</span>selectIAPL()
 {
     <span class="type"><a href="qvariant.html">QVariant</a></span> currentIAPValue <span class="operator">=</span> m_MediaObject<span class="operator">.</span>property(<span class="string">&quot;InternetAccessPointName&quot;</span>);
     <span class="type"><a href="qstring.html">QString</a></span> currentIAPString <span class="operator">=</span> currentIAPValue<span class="operator">.</span>toString();
     <span class="type">bool</span> ok <span class="operator">=</span> <span class="keyword">false</span>;
     CCommsDatabase <span class="operator">*</span>commsDb <span class="operator">=</span> CCommsDatabase<span class="operator">::</span>NewL(EDatabaseTypeIAP);
     CleanupStack<span class="operator">::</span>PushL(commsDb);
     commsDb<span class="operator">-</span><span class="operator">&gt;</span>ShowHiddenRecords();
     CCommsDbTableView<span class="operator">*</span> view <span class="operator">=</span> commsDb<span class="operator">-</span><span class="operator">&gt;</span>OpenTableLC(TPtrC(IAP));
     <span class="type"><a href="qstringlist.html">QStringList</a></span> items;
     TInt currentIAP <span class="operator">=</span> <span class="number">0</span>;
     <span class="keyword">for</span> (TInt l <span class="operator">=</span> view<span class="operator">-</span><span class="operator">&gt;</span>GotoFirstRecord()<span class="operator">,</span> i <span class="operator">=</span> <span class="number">0</span>; l <span class="operator">!</span><span class="operator">=</span> KErrNotFound; l <span class="operator">=</span> view<span class="operator">-</span><span class="operator">&gt;</span>GotoNextRecord()<span class="operator">,</span> i<span class="operator">+</span><span class="operator">+</span>) {
        TBuf<span class="operator">&lt;</span>KCommsDbSvrMaxColumnNameLength<span class="operator">&gt;</span> iapName;
        view<span class="operator">-</span><span class="operator">&gt;</span>ReadTextL(TPtrC(COMMDB_NAME)<span class="operator">,</span> iapName);
        <span class="type"><a href="qstring.html">QString</a></span> iapString <span class="operator">=</span> <span class="type"><a href="qstring.html">QString</a></span><span class="operator">::</span>fromUtf16(iapName<span class="operator">.</span>Ptr()<span class="operator">,</span> iapName<span class="operator">.</span>Length());
        items <span class="operator">&lt;</span><span class="operator">&lt;</span> iapString;
        <span class="keyword">if</span> (iapString <span class="operator">=</span><span class="operator">=</span> currentIAPString)
            currentIAP <span class="operator">=</span> i;
     }
     currentIAPString <span class="operator">=</span> <span class="type"><a href="qinputdialog.html">QInputDialog</a></span><span class="operator">::</span>getItem(<span class="keyword">this</span><span class="operator">,</span> tr(<span class="string">&quot;Select Access Point&quot;</span>)<span class="operator">,</span> tr(<span class="string">&quot;Select Access Point&quot;</span>)<span class="operator">,</span> items<span class="operator">,</span> currentIAP<span class="operator">,</span> <span class="keyword">false</span><span class="operator">,</span> <span class="operator">&amp;</span>ok);
     <span class="keyword">if</span> (ok)
         m_MediaObject<span class="operator">.</span>setProperty(<span class="string">&quot;InternetAccessPointName&quot;</span><span class="operator">,</span> currentIAPString);
     CleanupStack<span class="operator">::</span>PopAndDestroy(<span class="number">2</span>); <span class="comment">//commsDB, view</span>
 }
 <span class="preprocessor">#endif</span></pre>
</div>
<!-- @@@demos/qmediaplayer/mediaplayer.cpp -->
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2015 The Qt Company Ltd.
      Documentation contributions included herein are the copyrights of
      their respective owners.</p>
    <br />
    <p>
      The documentation provided herein is licensed under the terms of the
      <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation
      License version 1.3</a> as published by the Free Software Foundation.</p>
    <p>
      Documentation sources may be obtained from <a href="http://www.qt-project.org">
      www.qt-project.org</a>.</p>
    <br />
    <p>
      Qt and respective logos are trademarks of The Qt Company Ltd 
      in Finland and/or other countries worldwide. All other trademarks are property
      of their respective owners. <a title="Privacy Policy"
      href="http://en.gitorious.org/privacy_policy/">Privacy Policy</a></p>
  </div>

  <script src="scripts/functions.js" type="text/javascript"></script>
</body>
</html>
