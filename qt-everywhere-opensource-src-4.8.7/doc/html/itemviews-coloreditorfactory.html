<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- coloreditorfactory.qdoc -->
  <title>Qt 4.8: Color Editor Factory Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />
  <link rel="stylesheet" type="text/css" href="style/narrow.css" />
  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->

<script src="scripts/superfish.js" type="text/javascript"></script>
<script src="scripts/narrow.js" type="text/javascript"></script>

</head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="narrowsearch"></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.digia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://qt-project.org/">DEV</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://qt-project.org/doc/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.digia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.8</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt-project.org/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu" id="narrowmenu"> 
             <li><a href="#">API Lookup</a> 
                 <ul> 
                     <li><a href="classes.html">Class index</a></li> 
           <li><a href="functions.html">Function index</a></li> 
           <li><a href="modules.html">Modules</a></li> 
           <li><a href="namespaces.html">Namespaces</a></li> 
           <li><a href="qtglobal.html">Global Declarations</a></li> 
           <li><a href="qdeclarativeelements.html">QML elements</a></li> 
             </ul> 
             </li> 
             <li><a href="#">Qt Topics</a> 
                 <ul> 
                        <li><a href="qt-basic-concepts.html">Programming with Qt</a></li>  
                        <li><a href="qtquick.html">Device UIs &amp; Qt Quick</a></li>  
                        <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li>  
                        <li><a href="supported-platforms.html">Supported Platforms</a></li>  
                        <li><a href="technology-apis.html">Qt and Key Technologies</a></li>  
                        <li><a href="best-practices.html">How-To's and Best Practices</a></li>  
              </ul> 
                 </li> 
                 <li><a href="#">Examples</a> 
                     <ul> 
                       <li><a href="all-examples.html">Examples</a></li> 
                       <li><a href="tutorials.html">Tutorials</a></li> 
                       <li><a href="demos.html">Demos</a></li> 
                       <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
                </ul> 
                     </li> 
                 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search" id="sidebarsearch">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
 <div id="resultdialog"> 
 <a href="#" id="resultclose">Close</a> 
 <p id="resultlinks" class="all"><a href="#" id="showallresults">All</a> | <a href="#" id="showapiresults">API</a> | <a href="#" id="showarticleresults">Articles</a> | <a href="#" id="showexampleresults">Examples</a></p> 
 <p id="searchcount" class="all"><span id="resultcount"></span><span id="apicount"></span><span id="articlecount"></span><span id="examplecount"></span>&nbsp;results:</p> 
 <ul id="resultlist" class="all"> 
 </ul> 
 </div> 
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
               <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
               <li class="defaultLink"><a href="qtquick.html">Device UIs &amp; Qt Quick</a></li> 
               <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
               <li class="defaultLink"><a href="supported-platforms.html">Supported Platforms</a></li>  
               <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
               <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Breadcrumbs go here -->
<li><a href="all-examples.html">Examples</a></li>
<li>Color Editor Factory Example</li>
            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#window-class-implementation">Window Class Implementation</a></li>
<li class="level1"><a href="#colorlisteditor-definition">ColorListEditor Definition</a></li>
<li class="level1"><a href="#colorlisteditor-implementation">ColorListEditor Implementation</a></li>
<li class="level1"><a href="#further-customization-of-item-view-editors">Further Customization of Item View Editors</a></li>
</ul>
</div>
<h1 class="title">Color Editor Factory Example</h1>
<span class="subtitle"></span>
<!-- $$$itemviews/coloreditorfactory-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="itemviews-coloreditorfactory-colorlisteditor-cpp.html">itemviews/coloreditorfactory/colorlisteditor.cpp</a></li>
<li><a href="itemviews-coloreditorfactory-colorlisteditor-h.html">itemviews/coloreditorfactory/colorlisteditor.h</a></li>
<li><a href="itemviews-coloreditorfactory-window-cpp.html">itemviews/coloreditorfactory/window.cpp</a></li>
<li><a href="itemviews-coloreditorfactory-window-h.html">itemviews/coloreditorfactory/window.h</a></li>
<li><a href="itemviews-coloreditorfactory-main-cpp.html">itemviews/coloreditorfactory/main.cpp</a></li>
<li><a href="itemviews-coloreditorfactory-coloreditorfactory-pro.html">itemviews/coloreditorfactory/coloreditorfactory.pro</a></li>
</ul>
<p>The Color Editor Factory example shows how to create an editor that can be used by a <a href="qitemdelegate.html">QItemDelegate</a>.<p class="centerAlign"><img src="images/coloreditorfactoryimage.png" alt="" /></p><p>When editing data in a <a href="qlistview.html">QListView</a>, <a href="qtableview.html">QTableView</a>, or <a href="qtreeview.html">QTreeView</a>, editors are created and displayed by a <a href="model-view-programming.html#delegate-classes">delegate</a>. <a href="qitemdelegate.html">QItemDelegate</a>, which is the default delegate used by Qt's <a href="model-view-programming.html#view-classes">item views</a>, uses a <a href="qitemeditorfactory.html">QItemEditorFactory</a> to create editors for it. A unique instance provided by <a href="qitemeditorfactory.html">QItemEditorFactory</a> is by default installed on all item delegates.</p>
<p>An item editor factory contains a collection of <a href="qitemeditorcreatorbase.html">QItemEditorCreatorBase</a> instances, which are specialized factories that produce editors for one particular <a href="qvariant.html">QVariant</a> data type (all models in Qt store their data in <a href="qvariant.html">QVariant</a>s). An editor can be any Qt or custom widget.</p>
<p>In this example, we will create an editor (implemented in the <tt>ColorListEditor</tt> class) that can edit the <a href="qcolor.html">QColor</a> data type and be used by <a href="qitemdelegate.html">QItemDelegate</a>s. We do this by creating a new <a href="qitemeditorcreatorbase.html">QItemEditorCreatorBase</a> that produces <tt>ColorListEditors</tt> and register it with a new factory, which we set as the default editor item factory (the unique factory instance). To test our editor, we have implemented the <tt>Window</tt> class, which displays a <a href="qtablewidget.html">QTableWidget</a> in which <a href="qcolor.html">QColor</a>s can be edited.</p>
<a name="window-class-implementation"></a>
<h2>Window Class Implementation</h2>
<p>In the Window class, we create the item editor creator base for our color editor and add it to the default factory. We also create a <a href="qtablewidget.html">QTableWidget</a> in which our editor can be tested. It is filled with some data and displayed in a window.</p>
<p>We take a closer look at the constructor:</p>
<pre class="cpp"> Window<span class="operator">::</span>Window()
 {
     <span class="type"><a href="qitemeditorfactory.html">QItemEditorFactory</a></span> <span class="operator">*</span>factory <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qitemeditorfactory.html">QItemEditorFactory</a></span>;

     <span class="type"><a href="qitemeditorcreatorbase.html">QItemEditorCreatorBase</a></span> <span class="operator">*</span>colorListCreator <span class="operator">=</span>
         <span class="keyword">new</span> <span class="type"><a href="qstandarditemeditorcreator.html">QStandardItemEditorCreator</a></span><span class="operator">&lt;</span>ColorListEditor<span class="operator">&gt;</span>();

     factory<span class="operator">-</span><span class="operator">&gt;</span>registerEditor(<span class="type"><a href="qvariant.html">QVariant</a></span><span class="operator">::</span>Color<span class="operator">,</span> colorListCreator);

     <span class="type"><a href="qitemeditorfactory.html">QItemEditorFactory</a></span><span class="operator">::</span>setDefaultFactory(factory);

     createGUI();
 }</pre>
<p>The <a href="qstandarditemeditorcreator.html">QStandardItemEditorCreator</a> is a convenience class that inherits <a href="qitemeditorcreatorbase.html">QItemEditorCreatorBase</a>. Its constructor takes a template class, of which instances are returned from <a href="qitemeditorcreatorbase.html#createWidget">createWidget()</a>. The creator uses a constructor that takes a <a href="qwidget.html">QWidget</a> as its only parameter; the template class must provide this. This way, there is no need to subclass <a href="qstandarditemeditorcreator.html">QStandardItemEditorCreator</a>.</p>
<p>After the new factory has been set, all standard item delegates will use it (i.e, also delegates that were created before the new default factory was set).</p>
<p>The <tt>createGUI()</tt> function sets up the table and fills it with data.</p>
<a name="colorlisteditor-definition"></a>
<h2>ColorListEditor Definition</h2>
<p>The ColorListEditor inherits <a href="qcombobox.html">QComboBox</a> and lets the user select a <a href="qcolor.html">QColor</a> from its popup list.</p>
<pre class="cpp"> <span class="keyword">class</span> ColorListEditor : <span class="keyword">public</span> <span class="type"><a href="qcombobox.html">QComboBox</a></span>
 {
     Q_OBJECT
     Q_PROPERTY(<span class="type"><a href="qcolor.html">QColor</a></span> color READ color WRITE setColor USER <span class="keyword">true</span>)

 <span class="keyword">public</span>:
     ColorListEditor(<span class="type"><a href="qwidget.html">QWidget</a></span> <span class="operator">*</span>widget <span class="operator">=</span> <span class="number">0</span>);

 <span class="keyword">public</span>:
     <span class="type"><a href="qcolor.html">QColor</a></span> color() <span class="keyword">const</span>;
     <span class="type">void</span> setColor(<span class="type"><a href="qcolor.html">QColor</a></span> c);

 <span class="keyword">private</span>:
     <span class="type">void</span> populateList();
 };</pre>
<p><a href="qitemdelegate.html">QItemDelegate</a> manages the interaction between the editor and the model, i.e&#x2e;, it retrieves data to edit from the model and store data from the editor in the model. The data that is edited by an editor is stored in the editor's user data property, and the delegate uses Qt's <a href="properties.html#qt-s-property-system">property system</a> to access it by name. We declare our user data property with the Q_PROPERTY macro. The property is set to be the user type with the USER keyword.</p>
<a name="colorlisteditor-implementation"></a>
<h2>ColorListEditor Implementation</h2>
<p>The constructor of <tt>ColorListEditor</tt> simply calls <tt>populateList()</tt>, which we will look at later. We move on to the <tt>color()</tt> function:</p>
<pre class="cpp"> <span class="type"><a href="qcolor.html">QColor</a></span> ColorListEditor<span class="operator">::</span>color() <span class="keyword">const</span>
 {
     <span class="keyword">return</span> qvariant_cast<span class="operator">&lt;</span><span class="type"><a href="qcolor.html">QColor</a></span><span class="operator">&gt;</span>(itemData(currentIndex()<span class="operator">,</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>DecorationRole));
 }</pre>
<p>We return the data that is selected in the combobox. The data is stored in the <a href="qt.html#ItemDataRole-enum">Qt::DecorationRole</a> as the color is then also displayed in the popup list (as shown in the image above).</p>
<pre class="cpp"> <span class="type">void</span> ColorListEditor<span class="operator">::</span>setColor(<span class="type"><a href="qcolor.html">QColor</a></span> color)
 {
     setCurrentIndex(findData(color<span class="operator">,</span> <span class="type">int</span>(<span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>DecorationRole)));
 }</pre>
<p>The <tt>findData()</tt> function searches the items in the combobox and returns the index of the item that has <tt>color</tt> in the Qt::Decoration role.</p>
<pre class="cpp"> <span class="type">void</span> ColorListEditor<span class="operator">::</span>populateList()
 {
     <span class="type"><a href="qstringlist.html">QStringList</a></span> colorNames <span class="operator">=</span> <span class="type"><a href="qcolor.html">QColor</a></span><span class="operator">::</span>colorNames();

     <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">0</span>; i <span class="operator">&lt;</span> colorNames<span class="operator">.</span>size(); <span class="operator">+</span><span class="operator">+</span>i) {
         <span class="type"><a href="qcolor.html">QColor</a></span> color(colorNames<span class="operator">[</span>i<span class="operator">]</span>);

         insertItem(i<span class="operator">,</span> colorNames<span class="operator">[</span>i<span class="operator">]</span>);
         setItemData(i<span class="operator">,</span> color<span class="operator">,</span> <span class="type"><a href="qt.html">Qt</a></span><span class="operator">::</span>DecorationRole);
     }
 }</pre>
<p>Qt knows some predefined colors by name. We simply loop through these to fill our editor with items.</p>
<a name="further-customization-of-item-view-editors"></a>
<h2>Further Customization of Item View Editors</h2>
<p>You can customize Qt's <a href="model-view-programming.html">model view framework</a> in many ways. The procedure shown in this example is usually sufficient to provide custom editors. Further customization is achieved by subclassing <a href="qitemeditorfactory.html">QItemEditorFactory</a> and <a href="qitemeditorcreatorbase.html">QItemEditorCreatorBase</a>. It is also possible to subclass <a href="qitemdelegate.html">QItemDelegate</a> if you don't wish to use a factory at all.</p>
<p>Possible suggestions are:</p>
<ul>
<li>If the editor widget has no user property defined, the delegate asks the factory for the property name, which it in turn asks the item editor creator for. In this case, you can use the <a href="qitemeditorcreator.html">QItemEditorCreator</a> class, which takes the property name to use for editing as a constructor argument.</li>
<li>If the editor requires other constructors or other initialization than provided by <a href="qitemeditorcreatorbase.html">QItemEditorCreatorBase</a>, you must reimplement <a href="qitemeditorcreatorbase.html#createWidget">QItemEditorCreatorBase::createWidget</a>().</li>
<li>You could also subclass <a href="qitemeditorfactory.html">QItemEditorFactory</a> if you only want to provide editors for certain kinds of data or use another method of creating the editors than using creator bases.</li>
</ul>
<p>In this example, we use a standard <a href="qvariant.html">QVariant</a> data type. You can also use custom types. In the <a href="itemviews-stardelegate.html">Star Delegate Example</a>, we show how to store a custom data type in a <a href="qvariant.html">QVariant</a> and paint and edit it in a class that inherits <a href="qitemdelegate.html">QItemDelegate</a>.</p>
</div>
<!-- @@@itemviews/coloreditorfactory -->
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2015 The Qt Company Ltd.
      Documentation contributions included herein are the copyrights of
      their respective owners.</p>
    <br />
    <p>
      The documentation provided herein is licensed under the terms of the
      <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation
      License version 1.3</a> as published by the Free Software Foundation.</p>
    <p>
      Documentation sources may be obtained from <a href="http://www.qt-project.org">
      www.qt-project.org</a>.</p>
    <br />
    <p>
      Qt and respective logos are trademarks of The Qt Company Ltd 
      in Finland and/or other countries worldwide. All other trademarks are property
      of their respective owners. <a title="Privacy Policy"
      href="http://en.gitorious.org/privacy_policy/">Privacy Policy</a></p>
  </div>

  <script src="scripts/functions.js" type="text/javascript"></script>
</body>
</html>
