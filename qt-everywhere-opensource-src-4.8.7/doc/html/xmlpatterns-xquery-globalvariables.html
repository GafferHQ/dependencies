<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- globalVariables.qdoc -->
  <title>Qt 4.8: C++ Source Code Analyzer Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />
  <link rel="stylesheet" type="text/css" href="style/narrow.css" />
  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->

<script src="scripts/superfish.js" type="text/javascript"></script>
<script src="scripts/narrow.js" type="text/javascript"></script>

</head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="narrowsearch"></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.digia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://qt-project.org/">DEV</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://qt-project.org/doc/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.digia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.8</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt-project.org/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu" id="narrowmenu"> 
             <li><a href="#">API Lookup</a> 
                 <ul> 
                     <li><a href="classes.html">Class index</a></li> 
           <li><a href="functions.html">Function index</a></li> 
           <li><a href="modules.html">Modules</a></li> 
           <li><a href="namespaces.html">Namespaces</a></li> 
           <li><a href="qtglobal.html">Global Declarations</a></li> 
           <li><a href="qdeclarativeelements.html">QML elements</a></li> 
             </ul> 
             </li> 
             <li><a href="#">Qt Topics</a> 
                 <ul> 
                        <li><a href="qt-basic-concepts.html">Programming with Qt</a></li>  
                        <li><a href="qtquick.html">Device UIs &amp; Qt Quick</a></li>  
                        <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li>  
                        <li><a href="supported-platforms.html">Supported Platforms</a></li>  
                        <li><a href="technology-apis.html">Qt and Key Technologies</a></li>  
                        <li><a href="best-practices.html">How-To's and Best Practices</a></li>  
              </ul> 
                 </li> 
                 <li><a href="#">Examples</a> 
                     <ul> 
                       <li><a href="all-examples.html">Examples</a></li> 
                       <li><a href="tutorials.html">Tutorials</a></li> 
                       <li><a href="demos.html">Demos</a></li> 
                       <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
                </ul> 
                     </li> 
                 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search" id="sidebarsearch">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
 <div id="resultdialog"> 
 <a href="#" id="resultclose">Close</a> 
 <p id="resultlinks" class="all"><a href="#" id="showallresults">All</a> | <a href="#" id="showapiresults">API</a> | <a href="#" id="showarticleresults">Articles</a> | <a href="#" id="showexampleresults">Examples</a></p> 
 <p id="searchcount" class="all"><span id="resultcount"></span><span id="apicount"></span><span id="articlecount"></span><span id="examplecount"></span>&nbsp;results:</p> 
 <ul id="resultlist" class="all"> 
 </ul> 
 </div> 
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
               <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
               <li class="defaultLink"><a href="qtquick.html">Device UIs &amp; Qt Quick</a></li> 
               <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
               <li class="defaultLink"><a href="supported-platforms.html">Supported Platforms</a></li>  
               <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
               <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Breadcrumbs go here -->
<li><a href="all-examples.html">Examples</a></li>
<li>C++ Source Code Analyzer Example</li>
            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#introduction">Introduction</a></li>
<li class="level2"><a href="#reporting-uses-of-mutable-global-variables">Reporting Uses of Mutable Global Variables</a></li>
<li class="level3"><a href="#a-c-application">A C++ application</a></li>
<li class="level3"><a href="#the-xml-description-of-the-c-application">The XML description of the C++ application</a></li>
<li class="level3"><a href="#the-xquery-for-finding-global-variables">The XQuery for finding global variables</a></li>
<li class="level3"><a href="#running-the-xquery">Running the XQuery</a></li>
<li class="level3"><a href="#the-xquery-output">The XQuery output</a></li>
<li class="level1"><a href="#xquery-code-walk-through">XQuery Code Walk-Through</a></li>
</ul>
</div>
<h1 class="title">C++ Source Code Analyzer Example</h1>
<span class="subtitle"></span>
<!-- $$$xmlpatterns/xquery/globalVariables-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="xmlpatterns-xquery-globalvariables-globals-cpp.html">xmlpatterns/xquery/globalVariables/globals.cpp</a></li>
<li><a href="xmlpatterns-xquery-globalvariables-reportglobals-xq.html">xmlpatterns/xquery/globalVariables/reportGlobals.xq</a></li>
<li><a href="xmlpatterns-xquery-globalvariables-globalvariables-pro.html">xmlpatterns/xquery/globalVariables/globalVariables.pro</a></li>
</ul>
<p>The Global Variables example uses <a href="xmlprocessing.html">XQuery</a> and the <tt>xmlpatterns</tt> command line utility to query C++ source code.<a name="introduction"></a>
<h2>Introduction</h2>
<p>Suppose we want to analyze C++ source code to find coding standard violations and instances of bad or inefficient patterns. We can do it using the common searching and pattern matching utilities to process the C++ files (e.g&#x2e;, <tt>grep</tt>, <tt>sed</tt>, and <tt>awk</tt>). Now we can also use <a href="xmlprocessing.html">XQuery</a> with the <a href="qtxmlpatterns.html">QtXmlPatterns</a> module.</p>
<p>An extension to the <tt>g++</tt> open source C++ compiler (<a href="http://public.kitware.com/GCC_XML/HTML/Index.html">GCC-XML</a>) generates an XML description of C++ source code declarations. This XML description can then be processed by <a href="qtxmlpatterns.html">QtXmlPatterns</a> using XQueries to navigate the XML description of the C++ source and produce a report. Consider the problem of finding mutable global variables:</p>
<a name="reporting-uses-of-mutable-global-variables"></a>
<h3>Reporting Uses of Mutable Global Variables</h3>
<p>Suppose we want to introduce threading to a C++ application that was originally written without threading. In a threaded program, mutable global variables can cause bugs, because one thread might change a global variable that other threads are reading, or two threads might try to set the same global variable. So when converting our program to use threading, one of the things we must do is protect the global variables to prevent the bugs described above. How can we use <a href="xmlprocessing.html">XQuery</a> and <a href="http://public.kitware.com/GCC_XML/HTML/Index.html">GCC-XML</a> to find the variables that need protecting?</p>
<a name="a-c-application"></a>
<h4>A C++ application</h4>
<p>Consider the declarations in this hypothetical C++ application:</p>
<pre class="cpp">  <span class="number">1.</span> <span class="type">int</span> mutablePrimitive1;
  <span class="number">2.</span> <span class="type">int</span> mutablePrimitive2;
  <span class="number">3.</span> <span class="keyword">const</span> <span class="type">int</span> constPrimitive1 <span class="operator">=</span> <span class="number">4</span>;
  <span class="number">4.</span> <span class="keyword">const</span> <span class="type">int</span> constPrimitive2 <span class="operator">=</span> <span class="number">3</span>;
  <span class="number">5.</span>
  <span class="number">6.</span> <span class="keyword">class</span> ComplexClass
  <span class="number">7.</span> {
  <span class="number">8.</span>  <span class="keyword">public</span>:
  <span class="number">9.</span>    ComplexClass();
 <span class="number">10.</span>    ComplexClass(<span class="keyword">const</span> ComplexClass <span class="operator">&amp;</span>);
 <span class="number">11.</span>    <span class="operator">~</span>ComplexClass();
 <span class="number">12.</span> };
 <span class="number">13.</span>
 <span class="number">14.</span> ComplexClass mutableComplex1;
 <span class="number">15.</span> ComplexClass mutableComplex2;
 <span class="number">16.</span> <span class="keyword">const</span> ComplexClass constComplex1;
 <span class="number">17.</span> <span class="keyword">const</span> ComplexClass constComplex2;
 <span class="number">18.</span>
 <span class="number">19.</span> <span class="type">int</span> main()
 <span class="number">20.</span> {
 <span class="number">22.</span>     <span class="type">int</span> localVariable;
 <span class="number">23.</span>     localVariable <span class="operator">=</span> <span class="number">0</span>;
 <span class="number">24.</span>     <span class="keyword">return</span> localVariable;
 <span class="number">25.</span> }</pre>
<a name="the-xml-description-of-the-c-application"></a>
<h4>The XML description of the C++ application</h4>
<p>Submitting this C++ source to <a href="http://public.kitware.com/GCC_XML/HTML/Index.html">GCC-XML</a> produces this XML description:</p>
<pre class="qml"> &lt;?xml version=&quot;1.0&quot;?&gt;
 &lt;GCC_XML&gt;
   &lt;Namespace id=&quot;_1&quot; name=&quot;::&quot; members=&quot;_3 _4 _5 _6 _7 _8 _9 _10 _11 _12 _13 _14 _15 &quot; mangled=&quot;_Z2::&quot;/&gt;
   &lt;Namespace id=&quot;_2&quot; name=&quot;std&quot; context=&quot;_1&quot; members=&quot;&quot; mangled=&quot;_Z3std&quot;/&gt;
   &lt;Function id=&quot;_3&quot; name=&quot;_GLOBAL__D_globals.cppwVRo3a&quot; returns=&quot;_16&quot; context=&quot;_1&quot; location=&quot;f0:14&quot; file=&quot;f0&quot; line=&quot;14&quot; endline=&quot;14&quot;/&gt;
   &lt;Function id=&quot;_4&quot; name=&quot;_GLOBAL__I_globals.cppwVRo3a&quot; returns=&quot;_16&quot; context=&quot;_1&quot; location=&quot;f0:14&quot; file=&quot;f0&quot; line=&quot;14&quot; endline=&quot;14&quot;/&gt;
   &lt;Function id=&quot;_5&quot; name=&quot;__static_initialization_and_destruction_0&quot; returns=&quot;_16&quot; context=&quot;_1&quot; mangled=&quot;_Z41__static_initialization_and_destruction_0ii&quot; location=&quot;f0:23&quot; file=&quot;f0&quot; line=&quot;23&quot; endline=&quot;14&quot;&gt;
     &lt;Argument name=&quot;__initialize_p&quot; type=&quot;_17&quot;/&gt;
     &lt;Argument name=&quot;__priority&quot; type=&quot;_17&quot;/&gt;
   &lt;/Function&gt;
   &lt;Function id=&quot;_6&quot; name=&quot;main&quot; returns=&quot;_17&quot; context=&quot;_1&quot; location=&quot;f0:20&quot; file=&quot;f0&quot; line=&quot;20&quot; endline=&quot;24&quot;/&gt;
   &lt;Variable id=&quot;_7&quot; name=&quot;constComplex2&quot; type=&quot;_11c&quot; context=&quot;_1&quot; location=&quot;f0:17&quot; file=&quot;f0&quot; line=&quot;17&quot;/&gt;
   &lt;Variable id=&quot;_8&quot; name=&quot;constComplex1&quot; type=&quot;_11c&quot; context=&quot;_1&quot; location=&quot;f0:16&quot; file=&quot;f0&quot; line=&quot;16&quot;/&gt;
   &lt;Variable id=&quot;_9&quot; name=&quot;mutableComplex2&quot; type=&quot;_11&quot; context=&quot;_1&quot; location=&quot;f0:15&quot; file=&quot;f0&quot; line=&quot;15&quot;/&gt;
   &lt;Variable id=&quot;_10&quot; name=&quot;mutableComplex1&quot; type=&quot;_11&quot; context=&quot;_1&quot; location=&quot;f0:14&quot; file=&quot;f0&quot; line=&quot;14&quot;/&gt;
   &lt;Class id=&quot;_11&quot; name=&quot;ComplexClass&quot; context=&quot;_1&quot; mangled=&quot;12ComplexClass&quot; location=&quot;f0:7&quot; file=&quot;f0&quot; line=&quot;7&quot; members=&quot;_19 _20 _21 &quot; bases=&quot;&quot;/&gt;
   &lt;Variable id=&quot;_12&quot; name=&quot;constPrimitive2&quot; type=&quot;_17c&quot; init=&quot;3&quot; context=&quot;_1&quot; location=&quot;f0:4&quot; file=&quot;f0&quot; line=&quot;4&quot;/&gt;
   &lt;Variable id=&quot;_13&quot; name=&quot;constPrimitive1&quot; type=&quot;_17c&quot; init=&quot;4&quot; context=&quot;_1&quot; location=&quot;f0:3&quot; file=&quot;f0&quot; line=&quot;3&quot;/&gt;
   &lt;Variable id=&quot;_14&quot; name=&quot;mutablePrimitive2&quot; type=&quot;_17&quot; context=&quot;_1&quot; location=&quot;f0:2&quot; file=&quot;f0&quot; line=&quot;2&quot;/&gt;
   &lt;Variable id=&quot;_15&quot; name=&quot;mutablePrimitive1&quot; type=&quot;_17&quot; context=&quot;_1&quot; location=&quot;f0:1&quot; file=&quot;f0&quot; line=&quot;1&quot;/&gt;
   &lt;FundamentalType id=&quot;_16&quot; name=&quot;void&quot;/&gt;
   &lt;FundamentalType id=&quot;_17&quot; name=&quot;int&quot;/&gt;
   &lt;CvQualifiedType id=&quot;_11c&quot; type=&quot;_11&quot; const=&quot;1&quot;/&gt;
   &lt;Constructor id=&quot;_19&quot; name=&quot;ComplexClass&quot; context=&quot;_11&quot; mangled=&quot;_ZN12ComplexClassC1Ev *INTERNAL* &quot; location=&quot;f0:9&quot; file=&quot;f0&quot; line=&quot;9&quot; extern=&quot;1&quot;/&gt;
   &lt;Constructor id=&quot;_20&quot; name=&quot;ComplexClass&quot; context=&quot;_11&quot; mangled=&quot;_ZN12ComplexClassC1ERKS_ *INTERNAL* &quot; location=&quot;f0:10&quot; file=&quot;f0&quot; line=&quot;10&quot; extern=&quot;1&quot;&gt;
     &lt;Argument type=&quot;_23&quot;/&gt;
   &lt;/Constructor&gt;
   &lt;Destructor id=&quot;_21&quot; name=&quot;ComplexClass&quot; context=&quot;_11&quot; mangled=&quot;_ZN12ComplexClassD1Ev *INTERNAL* &quot; location=&quot;f0:11&quot; file=&quot;f0&quot; line=&quot;11&quot; extern=&quot;1&quot;&gt;
   &lt;/Destructor&gt;
   &lt;CvQualifiedType id=&quot;_17c&quot; type=&quot;_17&quot; const=&quot;1&quot;/&gt;
   &lt;ReferenceType id=&quot;_23&quot; type=&quot;_11c&quot;/&gt;
   &lt;File id=&quot;f0&quot; name=&quot;globals.cpp&quot;/&gt;
 &lt;/GCC_XML&gt;</pre>
<a name="the-xquery-for-finding-global-variables"></a>
<h4>The XQuery for finding global variables</h4>
<p>We need an <a href="xmlprocessing.html">XQuery</a> to find the global variables in the XML description. Here is our <a href="xmlprocessing.html">XQuery</a> source. We walk through it in <a href="#xquery-code-walk-through">XQuery Code Walk-Through</a>.</p>
<pre class="qml"> (:
     This XQuery loads a GCC-XML file and reports the locations of all
     global variables in the original C++ source. To run the query,
     use the command line:

     xmlpatterns reportGlobals.xq -param fileToOpen=globals.gccxml -output globals.html

     &quot;fileToOpen=globals.gccxml&quot; binds the file name &quot;globals.gccxml&quot;
     to the variable &quot;fileToOpen&quot; declared and used below.
 :)

 declare variable $fileToOpen as xs:anyURI external;
 declare variable $inDoc as document-node() := doc($fileToOpen);

 (:
    This function determines whether the typeId is a complex type,
    e.g. QString. We only check whether it's a class. To be strictly
    correct, we should check whether the class has a non-synthesized
    constructor. We accept both mutable and const types.
 :)
 declare function local:isComplexType($typeID as xs:string) as xs:boolean
 {
     exists($inDoc/GCC_XML/Class[@id = $typeID])
     or
     exists($inDoc/GCC_XML/Class[@id = $inDoc/GCC_XML/CvQualifiedType[@id = $typeID]/@type])
 };

 (:
    This function determines whether the typeId is a primitive type.
 :)
 declare function local:isPrimitive($typeId as xs:string) as xs:boolean
 {
     exists($inDoc/GCC_XML/FundamentalType[@id = $typeId])
 };

 (:
    This function constructs a line for the report. The line contains
    a variable name, the source file, and the line number.
 :)
 declare function local:location($block as element()) as xs:string
 {
     concat($inDoc/GCC_XML/File[@id = $block/@file]/@name, &quot; at line &quot;, $block/@line)
 };

 (:
    This function generates the report. Note that it is called once
    in the &lt;body&gt; element of the &lt;html&gt; output.

    It ignores const variables of simple types but reports all others.
 :)
 declare function local:report() as element()+
 {
     let $complexVariables as element(Variable)* := $inDoc/GCC_XML/Variable[local:isComplexType(@type)]
     return if (exists($complexVariables))
            then (&lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;Global variables with complex types:&lt;/p&gt;,
                  &lt;ol xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;
                     {
                         (: For each Variable in $complexVariables... :)
                         $complexVariables/&lt;li&gt;&lt;span class=&quot;variableName&quot;&gt;{string(@name)}&lt;/span&gt; in {local:location(.)}&lt;/li&gt;
                     }
                  &lt;/ol&gt;)
            else &lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;No complex global variables found.&lt;/p&gt;

     ,

     let $primitiveVariables as element(Variable)+ := $inDoc/GCC_XML/Variable[local:isPrimitive(@type)]
     return if (exists($primitiveVariables))
            then (&lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;Mutable global variables with primitives types:&lt;/p&gt;,
                  &lt;ol xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;
                     {
                         (: For each Variable in $complexVariables... :)
                         $primitiveVariables/&lt;li&gt;&lt;span class=&quot;variableName&quot;&gt;{string(@name)}&lt;/span&gt; in {local:location(.)}&lt;/li&gt;
                     }
                  &lt;/ol&gt;)
            else &lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;No mutable primitive global variables found.&lt;/p&gt;
 };

 (:
     This is where the &lt;html&gt; report is output. First
     there is some style stuff, then the &lt;body&gt; element,
     which contains the call to the \c{local:report()}
     declared above.
 :)
 &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml/&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
     &lt;head&gt;
         &lt;title&gt;Global variables report for {$fileToOpen}&lt;/title&gt;
     &lt;/head&gt;
     &lt;style type=&quot;text/css&quot;&gt;
         .details
         {{
             text-align: left;
             font-size: 80%;
             color: blue
         }}
         .variableName
         {{
             font-family: courier;
             color: blue
         }}
     &lt;/style&gt;

     &lt;body&gt;
         &lt;p class=&quot;details&quot;&gt;Start report: {current-dateTime()}&lt;/p&gt;
         {
             local:report()
         }
         &lt;p class=&quot;details&quot;&gt;End report: {current-dateTime()}&lt;/p&gt;
     &lt;/body&gt;

 &lt;/html&gt;</pre>
<a name="running-the-xquery"></a>
<h4>Running the XQuery</h4>
<p>To run the <a href="xmlprocessing.html">XQuery</a> using the <tt>xmlpatterns</tt> command line utility, enter the following command:</p>
<pre class="cpp"> xmlpatterns reportGlobals<span class="operator">.</span>xq <span class="operator">-</span>param fileToOpen<span class="operator">=</span>globals<span class="operator">.</span>gccxml <span class="operator">-</span>output globals<span class="operator">.</span>html</pre>
<a name="the-xquery-output"></a>
<h4>The XQuery output</h4>
<p>The <tt>xmlpatterns</tt> command loads and parses <tt>globals.gccxml</tt>, runs the <a href="xmlprocessing.html">XQuery</a> <tt>reportGlobals.xq</tt>, and generates this report:</p>
<div class="details"><p>Start report: 2008-12-16T13:43:49.65Z</p>
</div><p>Global variables with complex types:</p>
<ol class="1">
<li><span class="variableName">mutableComplex1</span> in globals.cpp at line 14</li>
<li><span class="variableName">mutableComplex2</span> in globals.cpp at line 15</li>
<li><span class="variableName">constComplex1</span> in globals.cpp at line 16</li>
<li><span class="variableName">constComplex2</span> in globals.cpp at line 17</li>
</ol>
<p>Mutable global variables with primitives types:</p>
<ol class="1">
<li><span class="variableName">mutablePrimitive1</span> in globals.cpp at line 1</li>
<li><span class="variableName">mutablePrimitive2</span> in globals.cpp at line 2</li>
</ol>
<div class="details"><p>End report: 2008-12-16T13:43:49.65Z</p>
</div><a name="xquery-code-walk-through"></a>
<h2>XQuery Code Walk-Through</h2>
<p>The <a href="xmlprocessing.html">XQuery</a> source is in <tt>examples/xmlpatterns/xquery/globalVariables/reportGlobals.xq</tt> It begins with two variable declarations that begin the <a href="xmlprocessing.html">XQuery</a>:</p>
<pre class="qml"> declare variable $fileToOpen as xs:anyURI external;
 declare variable $inDoc as document-node() := doc($fileToOpen);</pre>
<p>The first variable, <tt>$fileToOpen</tt>, appears in the <tt>xmlpatterns</tt> command shown earlier, as <tt>-param fileToOpen=globals.gccxml</tt>. This binds the variable name to the file name. This variable is then used in the declaration of the second variable, <tt>$inDoc</tt>, as the parameter to the <a href="http://www.w3.org/TR/xpath-functions/#func-doc">doc()</a> function. The <tt>doc()</tt> function returns the document node of <tt>globals.gccxml</tt>, which is assigned to <tt>$inDoc</tt> to be used later in the <a href="xmlprocessing.html">XQuery</a> as the root node of our searches for global variables.</p>
<p>Next skip to the end of the <a href="xmlprocessing.html">XQuery</a>, where the <tt>&lt;html&gt;</tt> element is constructed. The <tt>&lt;html&gt;</tt> will contain a <tt>&lt;head&gt;</tt> element to specify a heading for the html page, followed by some style instructions for displaying the text, and then the <tt>&lt;body&gt;</tt> element.</p>
<pre class="qml"> &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml/&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
     &lt;head&gt;
         &lt;title&gt;Global variables report for {$fileToOpen}&lt;/title&gt;
     &lt;/head&gt;
     &lt;style type=&quot;text/css&quot;&gt;
         .details
         {{
             text-align: left;
             font-size: 80%;
             color: blue
         }}
         .variableName
         {{
             font-family: courier;
             color: blue
         }}
     &lt;/style&gt;

     &lt;body&gt;
         &lt;p class=&quot;details&quot;&gt;Start report: {current-dateTime()}&lt;/p&gt;
         {
             local:report()
         }
         &lt;p class=&quot;details&quot;&gt;End report: {current-dateTime()}&lt;/p&gt;
     &lt;/body&gt;

 &lt;/html&gt;</pre>
<p>The <tt>&lt;body&gt;</tt> element contains a call to the <tt>local:report()</tt> function, which is where the query does the &quot;heavy lifting.&quot; Note the two <tt>return</tt> clauses separated by the <i>comma operator</i> about halfway down:</p>
<pre class="qml"> declare function local:report() as element()+
 {
     let $complexVariables as element(Variable)* := $inDoc/GCC_XML/Variable[local:isComplexType(@type)]
     return if (exists($complexVariables))
            then (&lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;Global variables with complex types:&lt;/p&gt;,
                  &lt;ol xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;
                     {
                         (: For each Variable in $complexVariables... :)
                         $complexVariables/&lt;li&gt;&lt;span class=&quot;variableName&quot;&gt;{string(@name)}&lt;/span&gt; in {local:location(.)}&lt;/li&gt;
                     }
                  &lt;/ol&gt;)
            else &lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;No complex global variables found.&lt;/p&gt;

     ,

     let $primitiveVariables as element(Variable)+ := $inDoc/GCC_XML/Variable[local:isPrimitive(@type)]
     return if (exists($primitiveVariables))
            then (&lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;Mutable global variables with primitives types:&lt;/p&gt;,
                  &lt;ol xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;
                     {
                         (: For each Variable in $complexVariables... :)
                         $primitiveVariables/&lt;li&gt;&lt;span class=&quot;variableName&quot;&gt;{string(@name)}&lt;/span&gt; in {local:location(.)}&lt;/li&gt;
                     }
                  &lt;/ol&gt;)
            else &lt;p xmlns=&quot;http://www.w3.org/1999/xhtml/&quot;&gt;No mutable primitive global variables found.&lt;/p&gt;
 };</pre>
<p>The <tt>return</tt> clauses are like two separate queries. The comma operator separating them means that both <tt>return</tt> clauses are executed and both return their results, or, rather, both output their results. The first <tt>return</tt> clause searches for global variables with complex types, and the second searches for mutable global variables with primitive types.</p>
<p>Here is the html generated for the <tt>&lt;body&gt;</tt> element. Compare it with the <a href="xmlprocessing.html">XQuery</a> code above:</p>
<pre class="qml">     &lt;body&gt;
         &lt;p class=&quot;details&quot;&gt;Start report: 2008-12-16T13:43:49.65Z&lt;/p&gt;
         &lt;p&gt;Global variables with complex types:&lt;/p&gt;
         &lt;ol&gt;
             &lt;li&gt;
                 &lt;span class=&quot;variableName&quot;&gt;mutableComplex1&lt;/span&gt; in globals.cpp at line 14&lt;/li&gt;
             &lt;li&gt;
                 &lt;span class=&quot;variableName&quot;&gt;mutableComplex2&lt;/span&gt; in globals.cpp at line 15&lt;/li&gt;
             &lt;li&gt;
                 &lt;span class=&quot;variableName&quot;&gt;constComplex1&lt;/span&gt; in globals.cpp at line 16&lt;/li&gt;
             &lt;li&gt;
                 &lt;span class=&quot;variableName&quot;&gt;constComplex2&lt;/span&gt; in globals.cpp at line 17&lt;/li&gt;
         &lt;/ol&gt;
         &lt;p&gt;Mutable global variables with primitives types:&lt;/p&gt;
         &lt;ol&gt;
             &lt;li&gt;
                 &lt;span class=&quot;variableName&quot;&gt;mutablePrimitive1&lt;/span&gt; in globals.cpp at line 1&lt;/li&gt;
             &lt;li&gt;
                 &lt;span class=&quot;variableName&quot;&gt;mutablePrimitive2&lt;/span&gt; in globals.cpp at line 2&lt;/li&gt;
         &lt;/ol&gt;
         &lt;p class=&quot;details&quot;&gt;End report: 2008-12-16T13:43:49.65Z&lt;/p&gt;
     &lt;/body&gt;</pre>
<p>The <a href="xmlprocessing.html">XQuery</a> declares three more local functions that are called in turn by the <tt>local:report()</tt> function. <tt>isComplexType()</tt> returns true if the variable has a complex type. The variable can be mutable or const.</p>
<pre class="qml"> declare function local:isComplexType($typeID as xs:string) as xs:boolean
 {
     exists($inDoc/GCC_XML/Class[@id = $typeID])
     or
     exists($inDoc/GCC_XML/Class[@id = $inDoc/GCC_XML/CvQualifiedType[@id = $typeID]/@type])
 };</pre>
<p><tt>isPrimitive()</tt> returns true if the variable has a primitive type. The variable must be mutable.</p>
<pre class="qml"> declare function local:isPrimitive($typeId as xs:string) as xs:boolean
 {
     exists($inDoc/GCC_XML/FundamentalType[@id = $typeId])
 };</pre>
<p><tt>location()</tt> returns a text constructed from the variable's file and line number attributes.</p>
<pre class="qml"> declare function local:location($block as element()) as xs:string
 {
     concat($inDoc/GCC_XML/File[@id = $block/@file]/@name, &quot; at line &quot;, $block/@line)
 };</pre>
</div>
<!-- @@@xmlpatterns/xquery/globalVariables -->
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2015 The Qt Company Ltd.
      Documentation contributions included herein are the copyrights of
      their respective owners.</p>
    <br />
    <p>
      The documentation provided herein is licensed under the terms of the
      <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation
      License version 1.3</a> as published by the Free Software Foundation.</p>
    <p>
      Documentation sources may be obtained from <a href="http://www.qt-project.org">
      www.qt-project.org</a>.</p>
    <br />
    <p>
      Qt and respective logos are trademarks of The Qt Company Ltd 
      in Finland and/or other countries worldwide. All other trademarks are property
      of their respective owners. <a title="Privacy Policy"
      href="http://en.gitorious.org/privacy_policy/">Privacy Policy</a></p>
  </div>

  <script src="scripts/functions.js" type="text/javascript"></script>
</body>
</html>
